"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/broker/tradelocker";
exports.ids = ["pages/api/broker/tradelocker"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbroker%2Ftradelocker&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbroker%5Ctradelocker.ts&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbroker%2Ftradelocker&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbroker%5Ctradelocker.ts&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_broker_tradelocker_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\broker\\tradelocker.ts */ \"(api)/./pages/api/broker/tradelocker.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_broker_tradelocker_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_broker_tradelocker_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/broker/tradelocker\",\n        pathname: \"/api/broker/tradelocker\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_broker_tradelocker_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmJyb2tlciUyRnRyYWRlbG9ja2VyJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNicm9rZXIlNUN0cmFkZWxvY2tlci50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNpRTtBQUNqRTtBQUNBLGlFQUFlLHdFQUFLLENBQUMsNkRBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLDZEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL3ZvaWQtdHJhZGluZy1wbGF0Zm9ybS8/YjQxYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXGJyb2tlclxcXFx0cmFkZWxvY2tlci50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2Jyb2tlci90cmFkZWxvY2tlclwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2Jyb2tlci90cmFkZWxvY2tlclwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbroker%2Ftradelocker&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbroker%5Ctradelocker.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/tradelocker-api.ts":
/*!********************************!*\
  !*** ./lib/tradelocker-api.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TradeLockerAPI: () => (/* binding */ TradeLockerAPI)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nclass TradeLockerAPI {\n    constructor(config){\n        this.lastRequestTime = 0;\n        this.minRequestInterval = 100 // 100ms between requests\n        ;\n        this.config = config;\n        this.prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\n        this.baseUrl = config.baseUrl || \"https://api.tradelocker.com\";\n    }\n    /**\r\n   * Rate limiting helper\r\n   */ async rateLimit() {\n        const now = Date.now();\n        const timeSinceLastRequest = now - this.lastRequestTime;\n        if (timeSinceLastRequest < this.minRequestInterval) {\n            const delay = this.minRequestInterval - timeSinceLastRequest;\n            await new Promise((resolve)=>setTimeout(resolve, delay));\n        }\n        this.lastRequestTime = Date.now();\n    }\n    /**\r\n   * Enhanced error handling for bot trading\r\n   */ async handleBotTradingError(error, operation) {\n        console.error(`TradeLocker Bot Error (${operation}):`, error);\n        // Handle specific error types\n        if (error.message?.includes(\"rate limit\")) {\n            throw new Error(`Rate limit exceeded. Please wait before retrying.`);\n        }\n        if (error.message?.includes(\"insufficient margin\")) {\n            throw new Error(`Insufficient margin for trade. Check account balance.`);\n        }\n        if (error.message?.includes(\"market closed\")) {\n            throw new Error(`Market is closed. Trading not available at this time.`);\n        }\n        if (error.message?.includes(\"invalid symbol\")) {\n            throw new Error(`Invalid trading symbol. Please check symbol format.`);\n        }\n        throw new Error(`TradeLocker ${operation} failed: ${error.message}`);\n    }\n    /**\r\n   * Test connection to TradeLocker\r\n   */ async testConnection() {\n        try {\n            const response = await this.makeRequest(\"GET\", \"/v1/accounts\");\n            return response.success === true;\n        } catch (error) {\n            console.error(\"TradeLocker connection test failed:\", error);\n            return false;\n        }\n    }\n    /**\r\n   * Get account balance\r\n   */ async getBalance() {\n        try {\n            const response = await this.makeRequest(\"GET\", `/v1/accounts/${this.config.accountId}/balance`);\n            if (response.success) {\n                return response.data.map((balance)=>({\n                        currency: balance.currency,\n                        balance: parseFloat(balance.balance),\n                        equity: parseFloat(balance.equity),\n                        margin: parseFloat(balance.margin),\n                        freeMargin: parseFloat(balance.freeMargin),\n                        marginLevel: parseFloat(balance.marginLevel)\n                    }));\n            }\n            throw new Error(\"Failed to fetch balance\");\n        } catch (error) {\n            console.error(\"Error fetching TradeLocker balance:\", error);\n            throw error;\n        }\n    }\n    /**\r\n   * Get current price for a symbol\r\n   */ async getCurrentPrice(symbol) {\n        try {\n            await this.rateLimit();\n            const response = await this.makeRequest(\"GET\", `/v1/quotes/${symbol}`);\n            if (response.success) {\n                return parseFloat(response.data.bid);\n            }\n            throw new Error(\"Failed to fetch price\");\n        } catch (error) {\n            console.error(\"Error fetching TradeLocker price:\", error);\n            throw error;\n        }\n    }\n    /**\r\n   * Get historical data\r\n   */ async getHistoricalData(symbol, timeframe, limit = 100) {\n        try {\n            const response = await this.makeRequest(\"GET\", `/v1/charts/${symbol}`, {\n                timeframe,\n                limit\n            });\n            if (response.success) {\n                return response.data.map((candle)=>({\n                        timestamp: new Date(candle.timestamp),\n                        open: parseFloat(candle.open),\n                        high: parseFloat(candle.high),\n                        low: parseFloat(candle.low),\n                        close: parseFloat(candle.close),\n                        volume: parseFloat(candle.volume)\n                    }));\n            }\n            throw new Error(\"Failed to fetch historical data\");\n        } catch (error) {\n            console.error(\"Error fetching TradeLocker historical data:\", error);\n            throw error;\n        }\n    }\n    /**\r\n   * Place a market order\r\n   */ async placeMarketOrder(order) {\n        try {\n            const orderData = {\n                symbol: order.symbol,\n                side: order.side,\n                type: \"market\",\n                quantity: order.quantity,\n                timeInForce: order.timeInForce || \"GTC\"\n            };\n            const response = await this.makeRequest(\"POST\", `/v1/accounts/${this.config.accountId}/orders`, orderData);\n            if (response.success) {\n                // If stop loss and take profit are specified, add them\n                if (order.stopLoss || order.takeProfit) {\n                    await this.addStopLossTakeProfit(response.data.orderId, order);\n                }\n                return {\n                    success: true,\n                    orderId: response.data.orderId,\n                    status: response.data.status,\n                    filledQuantity: response.data.filledQuantity,\n                    averagePrice: response.data.averagePrice\n                };\n            }\n            throw new Error(\"Failed to place order\");\n        } catch (error) {\n            console.error(\"Error placing TradeLocker order:\", error);\n            throw error;\n        }\n    }\n    /**\r\n   * Place a limit order\r\n   */ async placeLimitOrder(order) {\n        try {\n            if (!order.price) {\n                throw new Error(\"Price is required for limit orders\");\n            }\n            const orderData = {\n                symbol: order.symbol,\n                side: order.side,\n                type: \"limit\",\n                quantity: order.quantity,\n                price: order.price,\n                timeInForce: order.timeInForce || \"GTC\"\n            };\n            const response = await this.makeRequest(\"POST\", `/v1/accounts/${this.config.accountId}/orders`, orderData);\n            if (response.success) {\n                // If stop loss and take profit are specified, add them\n                if (order.stopLoss || order.takeProfit) {\n                    await this.addStopLossTakeProfit(response.data.orderId, order);\n                }\n                return {\n                    success: true,\n                    orderId: response.data.orderId,\n                    status: response.data.status\n                };\n            }\n            throw new Error(\"Failed to place limit order\");\n        } catch (error) {\n            console.error(\"Error placing TradeLocker limit order:\", error);\n            throw error;\n        }\n    }\n    /**\r\n   * Add stop loss and take profit to an existing position\r\n   */ async addStopLossTakeProfit(orderId, order) {\n        try {\n            if (order.stopLoss) {\n                await this.makeRequest(\"POST\", `/v1/accounts/${this.config.accountId}/positions/${orderId}/stop-loss`, {\n                    price: order.stopLoss\n                });\n            }\n            if (order.takeProfit) {\n                await this.makeRequest(\"POST\", `/v1/accounts/${this.config.accountId}/positions/${orderId}/take-profit`, {\n                    price: order.takeProfit\n                });\n            }\n        } catch (error) {\n            console.error(\"Error adding stop loss/take profit:\", error);\n        }\n    }\n    /**\r\n   * Close a position\r\n   */ async closePosition(symbol, quantity) {\n        try {\n            const positions = await this.getPositions();\n            const position = positions.find((p)=>p.symbol === symbol);\n            if (!position) {\n                throw new Error(\"Position not found\");\n            }\n            const closeQuantity = quantity || position.quantity;\n            const side = position.side === \"long\" ? \"sell\" : \"buy\";\n            const orderData = {\n                symbol: symbol,\n                side: side,\n                type: \"market\",\n                quantity: closeQuantity,\n                timeInForce: \"IOC\"\n            };\n            const response = await this.makeRequest(\"POST\", `/v1/accounts/${this.config.accountId}/orders`, orderData);\n            if (response.success) {\n                return {\n                    success: true,\n                    orderId: response.data.orderId,\n                    status: response.data.status,\n                    closedQuantity: closeQuantity\n                };\n            }\n            throw new Error(\"Failed to close position\");\n        } catch (error) {\n            console.error(\"Error closing TradeLocker position:\", error);\n            throw error;\n        }\n    }\n    /**\r\n   * Get open positions\r\n   */ async getPositions() {\n        try {\n            const response = await this.makeRequest(\"GET\", `/v1/accounts/${this.config.accountId}/positions`);\n            if (response.success) {\n                return response.data.map((position)=>({\n                        id: position.id,\n                        symbol: position.symbol,\n                        side: position.side,\n                        quantity: parseFloat(position.quantity),\n                        entryPrice: parseFloat(position.entryPrice),\n                        currentPrice: parseFloat(position.currentPrice),\n                        unrealizedPnL: parseFloat(position.unrealizedPnL),\n                        stopLoss: position.stopLoss ? parseFloat(position.stopLoss) : undefined,\n                        takeProfit: position.takeProfit ? parseFloat(position.takeProfit) : undefined,\n                        timestamp: new Date(position.timestamp)\n                    }));\n            }\n            throw new Error(\"Failed to fetch positions\");\n        } catch (error) {\n            console.error(\"Error fetching TradeLocker positions:\", error);\n            throw error;\n        }\n    }\n    /**\r\n   * Get order history\r\n   */ async getOrderHistory(symbol, limit = 100) {\n        try {\n            const params = new URLSearchParams();\n            if (symbol) params.append(\"symbol\", symbol);\n            params.append(\"limit\", limit.toString());\n            const response = await this.makeRequest(\"GET\", `/v1/accounts/${this.config.accountId}/orders?${params}`);\n            if (response.success) {\n                return response.data.map((order)=>({\n                        id: order.id,\n                        symbol: order.symbol,\n                        side: order.side,\n                        type: order.type,\n                        quantity: parseFloat(order.quantity),\n                        price: parseFloat(order.price),\n                        status: order.status,\n                        filledQuantity: parseFloat(order.filledQuantity),\n                        averagePrice: parseFloat(order.averagePrice),\n                        timestamp: new Date(order.timestamp)\n                    }));\n            }\n            throw new Error(\"Failed to fetch order history\");\n        } catch (error) {\n            console.error(\"Error fetching TradeLocker order history:\", error);\n            throw error;\n        }\n    }\n    /**\r\n   * Cancel an order\r\n   */ async cancelOrder(orderId) {\n        try {\n            const response = await this.makeRequest(\"DELETE\", `/v1/accounts/${this.config.accountId}/orders/${orderId}`);\n            if (response.success) {\n                return {\n                    success: true,\n                    orderId: orderId,\n                    status: \"cancelled\"\n                };\n            }\n            throw new Error(\"Failed to cancel order\");\n        } catch (error) {\n            console.error(\"Error cancelling TradeLocker order:\", error);\n            throw error;\n        }\n    }\n    /**\r\n   * Make authenticated request to TradeLocker API\r\n   */ async makeRequest(method, endpoint, data) {\n        const url = `${this.baseUrl}${endpoint}`;\n        const timestamp = Date.now().toString();\n        // Create signature for authentication\n        const signature = this.createSignature(method, endpoint, timestamp, data);\n        const headers = {\n            \"Content-Type\": \"application/json\",\n            \"X-API-Key\": this.config.apiKey,\n            \"X-Timestamp\": timestamp,\n            \"X-Signature\": signature\n        };\n        const requestOptions = {\n            method,\n            headers\n        };\n        if (data && method !== \"GET\") {\n            requestOptions.body = JSON.stringify(data);\n        }\n        const response = await fetch(url, requestOptions);\n        const result = await response.json();\n        if (!response.ok) {\n            throw new Error(`TradeLocker API error: ${result.message || response.statusText}`);\n        }\n        return result;\n    }\n    /**\r\n   * Create signature for API authentication\r\n   */ createSignature(method, endpoint, timestamp, data) {\n        const message = `${method}${endpoint}${timestamp}${data ? JSON.stringify(data) : \"\"}`;\n        // Use crypto-js or similar library for HMAC-SHA256\n        // For now, we'll use a simple hash (you should implement proper HMAC)\n        const crypto = __webpack_require__(/*! crypto */ \"crypto\");\n        return crypto.createHmac(\"sha256\", this.config.secretKey).update(message).digest(\"hex\");\n    }\n    /**\r\n   * Save broker configuration to database\r\n   */ async saveConfig() {\n        try {\n            await this.prisma.brokerConfig.upsert({\n                where: {\n                    broker: \"tradelocker\"\n                },\n                update: {\n                    apiKey: this.config.apiKey,\n                    secretKey: this.config.secretKey,\n                    accountId: this.config.accountId,\n                    baseUrl: this.config.baseUrl,\n                    environment: this.config.environment\n                },\n                create: {\n                    broker: \"tradelocker\",\n                    apiKey: this.config.apiKey,\n                    secretKey: this.config.secretKey,\n                    accountId: this.config.accountId,\n                    baseUrl: this.config.baseUrl,\n                    environment: this.config.environment\n                }\n            });\n        } catch (error) {\n            console.error(\"Error saving TradeLocker config:\", error);\n            throw error;\n        }\n    }\n    /**\r\n   * Load broker configuration from database\r\n   */ async loadConfig() {\n        try {\n            const config = await this.prisma.brokerConfig.findUnique({\n                where: {\n                    broker: \"tradelocker\"\n                }\n            });\n            if (config) {\n                this.config = {\n                    apiKey: config.apiKey,\n                    secretKey: config.secretKey,\n                    accountId: config.accountId,\n                    baseUrl: config.baseUrl,\n                    environment: config.environment\n                };\n                return this.config;\n            }\n            return null;\n        } catch (error) {\n            console.error(\"Error loading TradeLocker config:\", error);\n            return null;\n        }\n    }\n    /**\r\n   * Bot-optimized market order placement\r\n   */ async placeBotMarketOrder(order) {\n        try {\n            await this.rateLimit();\n            const orderData = {\n                symbol: order.symbol,\n                side: order.side,\n                type: \"market\",\n                quantity: order.quantity,\n                timeInForce: order.timeInForce || \"IOC\" // Immediate or Cancel for bots\n            };\n            const response = await this.makeRequest(\"POST\", `/v1/accounts/${this.config.accountId}/orders`, orderData);\n            if (response.success) {\n                // Log successful bot trade\n                console.log(`Bot Trade Executed: ${order.side} ${order.quantity} ${order.symbol} at market`);\n                // If stop loss and take profit are specified, add them\n                if (order.stopLoss || order.takeProfit) {\n                    await this.addStopLossTakeProfit(response.data.orderId, order);\n                }\n                return {\n                    success: true,\n                    orderId: response.data.orderId,\n                    status: response.data.status,\n                    filledQuantity: response.data.filledQuantity,\n                    averagePrice: response.data.averagePrice,\n                    timestamp: new Date()\n                };\n            }\n            throw new Error(\"Failed to place bot order\");\n        } catch (error) {\n            return this.handleBotTradingError(error, \"market order\");\n        }\n    }\n    /**\r\n   * Bot-optimized limit order placement\r\n   */ async placeBotLimitOrder(order) {\n        try {\n            await this.rateLimit();\n            if (!order.price) {\n                throw new Error(\"Price is required for limit orders\");\n            }\n            const orderData = {\n                symbol: order.symbol,\n                side: order.side,\n                type: \"limit\",\n                quantity: order.quantity,\n                price: order.price,\n                timeInForce: order.timeInForce || \"GTC\"\n            };\n            const response = await this.makeRequest(\"POST\", `/v1/accounts/${this.config.accountId}/orders`, orderData);\n            if (response.success) {\n                console.log(`Bot Limit Order Placed: ${order.side} ${order.quantity} ${order.symbol} at ${order.price}`);\n                if (order.stopLoss || order.takeProfit) {\n                    await this.addStopLossTakeProfit(response.data.orderId, order);\n                }\n                return {\n                    success: true,\n                    orderId: response.data.orderId,\n                    status: response.data.status,\n                    timestamp: new Date()\n                };\n            }\n            throw new Error(\"Failed to place bot limit order\");\n        } catch (error) {\n            return this.handleBotTradingError(error, \"limit order\");\n        }\n    }\n    /**\r\n   * Bot-optimized position closing\r\n   */ async closeBotPosition(symbol, quantity) {\n        try {\n            await this.rateLimit();\n            const positions = await this.getPositions();\n            const position = positions.find((p)=>p.symbol === symbol);\n            if (!position) {\n                throw new Error(\"Position not found for bot to close\");\n            }\n            const closeQuantity = quantity || position.quantity;\n            const side = position.side === \"long\" ? \"sell\" : \"buy\";\n            const orderData = {\n                symbol: symbol,\n                side: side,\n                type: \"market\",\n                quantity: closeQuantity,\n                timeInForce: \"IOC\"\n            };\n            const response = await this.makeRequest(\"POST\", `/v1/accounts/${this.config.accountId}/orders`, orderData);\n            if (response.success) {\n                console.log(`Bot Position Closed: ${closeQuantity} ${symbol}`);\n                return {\n                    success: true,\n                    orderId: response.data.orderId,\n                    status: response.data.status,\n                    closedQuantity: closeQuantity,\n                    timestamp: new Date()\n                };\n            }\n            throw new Error(\"Failed to close bot position\");\n        } catch (error) {\n            return this.handleBotTradingError(error, \"position close\");\n        }\n    }\n    /**\r\n   * Get account balance for bot risk management\r\n   */ async getBotBalance() {\n        try {\n            await this.rateLimit();\n            const response = await this.makeRequest(\"GET\", `/v1/accounts/${this.config.accountId}/balance`);\n            if (response.success) {\n                return response.data.map((balance)=>({\n                        currency: balance.currency,\n                        balance: parseFloat(balance.balance),\n                        equity: parseFloat(balance.equity),\n                        margin: parseFloat(balance.margin),\n                        freeMargin: parseFloat(balance.freeMargin),\n                        marginLevel: parseFloat(balance.marginLevel)\n                    }));\n            }\n            throw new Error(\"Failed to fetch bot balance\");\n        } catch (error) {\n            return this.handleBotTradingError(error, \"balance fetch\");\n        }\n    }\n    /**\r\n   * Check if bot can place trade (risk management)\r\n   */ async canBotTrade(symbol, quantity, side) {\n        try {\n            await this.rateLimit();\n            // Get current balance\n            const balance = await this.getBotBalance();\n            const usdBalance = balance.find((b)=>b.currency === \"USD\");\n            if (!usdBalance) {\n                console.error(\"Bot: No USD balance found\");\n                return false;\n            }\n            // Get current price\n            const currentPrice = await this.getCurrentPrice(symbol);\n            // Calculate required margin (assuming 1:100 leverage)\n            const requiredMargin = quantity * currentPrice / 100;\n            // Check if we have enough free margin\n            if (usdBalance.freeMargin < requiredMargin) {\n                console.error(`Bot: Insufficient margin. Required: ${requiredMargin}, Available: ${usdBalance.freeMargin}`);\n                return false;\n            }\n            // Check margin level (should be above 200% for safety)\n            if (usdBalance.marginLevel < 200) {\n                console.error(`Bot: Margin level too low: ${usdBalance.marginLevel}%`);\n                return false;\n            }\n            return true;\n        } catch (error) {\n            console.error(\"Bot: Error checking trade feasibility:\", error);\n            return false;\n        }\n    }\n    /**\r\n   * Get positions for bot monitoring\r\n   */ async getBotPositions() {\n        try {\n            await this.rateLimit();\n            const response = await this.makeRequest(\"GET\", `/v1/accounts/${this.config.accountId}/positions`);\n            if (response.success) {\n                return response.data.map((position)=>({\n                        id: position.id,\n                        symbol: position.symbol,\n                        side: position.side,\n                        quantity: parseFloat(position.quantity),\n                        entryPrice: parseFloat(position.entryPrice),\n                        currentPrice: parseFloat(position.currentPrice),\n                        unrealizedPnL: parseFloat(position.unrealizedPnL),\n                        stopLoss: position.stopLoss ? parseFloat(position.stopLoss) : undefined,\n                        takeProfit: position.takeProfit ? parseFloat(position.takeProfit) : undefined,\n                        timestamp: new Date(position.timestamp)\n                    }));\n            }\n            throw new Error(\"Failed to fetch bot positions\");\n        } catch (error) {\n            return this.handleBotTradingError(error, \"positions fetch\");\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0E7WUFDeEQsT0FBTztRQUNUO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU02RyxrQkFBa0Q7UUFDdEQsSUFBSTtZQUNGLE1BQU0sSUFBSSxDQUFDdEgsU0FBUztZQUVwQixNQUFNZ0IsV0FBVyxNQUFNLElBQUksQ0FBQ0MsV0FBVyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDdEIsTUFBTSxDQUFDeUIsU0FBUyxDQUFDLFVBQVUsQ0FBQztZQUVoRyxJQUFJSixTQUFTRSxPQUFPLEVBQUU7Z0JBQ3BCLE9BQU9GLFNBQVNLLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUN3QyxXQUFtQjt3QkFDM0NLLElBQUlMLFNBQVNLLEVBQUU7d0JBQ2ZwQyxRQUFRK0IsU0FBUy9CLE1BQU07d0JBQ3ZCZSxNQUFNZ0IsU0FBU2hCLElBQUk7d0JBQ25CRSxVQUFVdkIsV0FBV3FDLFNBQVNkLFFBQVE7d0JBQ3RDb0IsWUFBWTNDLFdBQVdxQyxTQUFTTSxVQUFVO3dCQUMxQ0MsY0FBYzVDLFdBQVdxQyxTQUFTTyxZQUFZO3dCQUM5Q0MsZUFBZTdDLFdBQVdxQyxTQUFTUSxhQUFhO3dCQUNoRHBCLFVBQVVZLFNBQVNaLFFBQVEsR0FBR3pCLFdBQVdxQyxTQUFTWixRQUFRLElBQUlxQjt3QkFDOURwQixZQUFZVyxTQUFTWCxVQUFVLEdBQUcxQixXQUFXcUMsU0FBU1gsVUFBVSxJQUFJb0I7d0JBQ3BFbEMsV0FBVyxJQUFJbkMsS0FBSzRELFNBQVN6QixTQUFTO29CQUN4QztZQUNGO1lBRUEsTUFBTSxJQUFJdkIsTUFBTTtRQUNsQixFQUFFLE9BQU9MLE9BQVk7WUFDbkIsT0FBTyxJQUFJLENBQUNELHFCQUFxQixDQUFDQyxPQUFPO1FBQzNDO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3ZvaWQtdHJhZGluZy1wbGF0Zm9ybS8uL2xpYi90cmFkZWxvY2tlci1hcGkudHM/YjcyMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRyYWRlTG9ja2VyQ29uZmlnIHtcclxuICBhcGlLZXk6IHN0cmluZztcclxuICBzZWNyZXRLZXk6IHN0cmluZztcclxuICBhY2NvdW50SWQ6IHN0cmluZztcclxuICBiYXNlVXJsOiBzdHJpbmc7XHJcbiAgZW52aXJvbm1lbnQ6ICdkZW1vJyB8ICdsaXZlJztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBUcmFkZUxvY2tlck9yZGVyIHtcclxuICBzeW1ib2w6IHN0cmluZztcclxuICBzaWRlOiAnYnV5JyB8ICdzZWxsJztcclxuICB0eXBlOiAnbWFya2V0JyB8ICdsaW1pdCcgfCAnc3RvcCcgfCAnc3RvcF9saW1pdCc7XHJcbiAgcXVhbnRpdHk6IG51bWJlcjtcclxuICBwcmljZT86IG51bWJlcjtcclxuICBzdG9wTG9zcz86IG51bWJlcjtcclxuICB0YWtlUHJvZml0PzogbnVtYmVyO1xyXG4gIHRpbWVJbkZvcmNlPzogJ0dUQycgfCAnSU9DJyB8ICdGT0snO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRyYWRlTG9ja2VyUG9zaXRpb24ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgc3ltYm9sOiBzdHJpbmc7XHJcbiAgc2lkZTogJ2xvbmcnIHwgJ3Nob3J0JztcclxuICBxdWFudGl0eTogbnVtYmVyO1xyXG4gIGVudHJ5UHJpY2U6IG51bWJlcjtcclxuICBjdXJyZW50UHJpY2U6IG51bWJlcjtcclxuICB1bnJlYWxpemVkUG5MOiBudW1iZXI7XHJcbiAgc3RvcExvc3M/OiBudW1iZXI7XHJcbiAgdGFrZVByb2ZpdD86IG51bWJlcjtcclxuICB0aW1lc3RhbXA6IERhdGU7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHJhZGVMb2NrZXJCYWxhbmNlIHtcclxuICBjdXJyZW5jeTogc3RyaW5nO1xyXG4gIGJhbGFuY2U6IG51bWJlcjtcclxuICBlcXVpdHk6IG51bWJlcjtcclxuICBtYXJnaW46IG51bWJlcjtcclxuICBmcmVlTWFyZ2luOiBudW1iZXI7XHJcbiAgbWFyZ2luTGV2ZWw6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFRyYWRlTG9ja2VyQVBJIHtcclxuICBwcml2YXRlIGNvbmZpZzogVHJhZGVMb2NrZXJDb25maWc7XHJcbiAgcHJpdmF0ZSBwcmlzbWE6IFByaXNtYUNsaWVudDtcclxuICBwcml2YXRlIGJhc2VVcmw6IHN0cmluZztcclxuICBwcml2YXRlIGxhc3RSZXF1ZXN0VGltZTogbnVtYmVyID0gMDtcclxuICBwcml2YXRlIG1pblJlcXVlc3RJbnRlcnZhbDogbnVtYmVyID0gMTAwOyAvLyAxMDBtcyBiZXR3ZWVuIHJlcXVlc3RzXHJcblxyXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogVHJhZGVMb2NrZXJDb25maWcpIHtcclxuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xyXG4gICAgdGhpcy5wcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XHJcbiAgICB0aGlzLmJhc2VVcmwgPSBjb25maWcuYmFzZVVybCB8fCAnaHR0cHM6Ly9hcGkudHJhZGVsb2NrZXIuY29tJztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJhdGUgbGltaXRpbmcgaGVscGVyXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyByYXRlTGltaXQoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xyXG4gICAgY29uc3QgdGltZVNpbmNlTGFzdFJlcXVlc3QgPSBub3cgLSB0aGlzLmxhc3RSZXF1ZXN0VGltZTtcclxuICAgIFxyXG4gICAgaWYgKHRpbWVTaW5jZUxhc3RSZXF1ZXN0IDwgdGhpcy5taW5SZXF1ZXN0SW50ZXJ2YWwpIHtcclxuICAgICAgY29uc3QgZGVsYXkgPSB0aGlzLm1pblJlcXVlc3RJbnRlcnZhbCAtIHRpbWVTaW5jZUxhc3RSZXF1ZXN0O1xyXG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXkpKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdGhpcy5sYXN0UmVxdWVzdFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRW5oYW5jZWQgZXJyb3IgaGFuZGxpbmcgZm9yIGJvdCB0cmFkaW5nXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVCb3RUcmFkaW5nRXJyb3IoZXJyb3I6IGFueSwgb3BlcmF0aW9uOiBzdHJpbmcpOiBQcm9taXNlPG5ldmVyPiB7XHJcbiAgICBjb25zb2xlLmVycm9yKGBUcmFkZUxvY2tlciBCb3QgRXJyb3IgKCR7b3BlcmF0aW9ufSk6YCwgZXJyb3IpO1xyXG4gICAgXHJcbiAgICAvLyBIYW5kbGUgc3BlY2lmaWMgZXJyb3IgdHlwZXNcclxuICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygncmF0ZSBsaW1pdCcpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUmF0ZSBsaW1pdCBleGNlZWRlZC4gUGxlYXNlIHdhaXQgYmVmb3JlIHJldHJ5aW5nLmApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ2luc3VmZmljaWVudCBtYXJnaW4nKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEluc3VmZmljaWVudCBtYXJnaW4gZm9yIHRyYWRlLiBDaGVjayBhY2NvdW50IGJhbGFuY2UuYCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnbWFya2V0IGNsb3NlZCcpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTWFya2V0IGlzIGNsb3NlZC4gVHJhZGluZyBub3QgYXZhaWxhYmxlIGF0IHRoaXMgdGltZS5gKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdpbnZhbGlkIHN5bWJvbCcpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCB0cmFkaW5nIHN5bWJvbC4gUGxlYXNlIGNoZWNrIHN5bWJvbCBmb3JtYXQuYCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRocm93IG5ldyBFcnJvcihgVHJhZGVMb2NrZXIgJHtvcGVyYXRpb259IGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGVzdCBjb25uZWN0aW9uIHRvIFRyYWRlTG9ja2VyXHJcbiAgICovXHJcbiAgYXN5bmMgdGVzdENvbm5lY3Rpb24oKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3QoJ0dFVCcsICcvdjEvYWNjb3VudHMnKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN1Y2Nlc3MgPT09IHRydWU7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdUcmFkZUxvY2tlciBjb25uZWN0aW9uIHRlc3QgZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGFjY291bnQgYmFsYW5jZVxyXG4gICAqL1xyXG4gIGFzeW5jIGdldEJhbGFuY2UoKTogUHJvbWlzZTxUcmFkZUxvY2tlckJhbGFuY2VbXT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCdHRVQnLCBgL3YxL2FjY291bnRzLyR7dGhpcy5jb25maWcuYWNjb3VudElkfS9iYWxhbmNlYCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLm1hcCgoYmFsYW5jZTogYW55KSA9PiAoe1xyXG4gICAgICAgICAgY3VycmVuY3k6IGJhbGFuY2UuY3VycmVuY3ksXHJcbiAgICAgICAgICBiYWxhbmNlOiBwYXJzZUZsb2F0KGJhbGFuY2UuYmFsYW5jZSksXHJcbiAgICAgICAgICBlcXVpdHk6IHBhcnNlRmxvYXQoYmFsYW5jZS5lcXVpdHkpLFxyXG4gICAgICAgICAgbWFyZ2luOiBwYXJzZUZsb2F0KGJhbGFuY2UubWFyZ2luKSxcclxuICAgICAgICAgIGZyZWVNYXJnaW46IHBhcnNlRmxvYXQoYmFsYW5jZS5mcmVlTWFyZ2luKSxcclxuICAgICAgICAgIG1hcmdpbkxldmVsOiBwYXJzZUZsb2F0KGJhbGFuY2UubWFyZ2luTGV2ZWwpXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBiYWxhbmNlJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBUcmFkZUxvY2tlciBiYWxhbmNlOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgY3VycmVudCBwcmljZSBmb3IgYSBzeW1ib2xcclxuICAgKi9cclxuICBhc3luYyBnZXRDdXJyZW50UHJpY2Uoc3ltYm9sOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgdGhpcy5yYXRlTGltaXQoKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnR0VUJywgYC92MS9xdW90ZXMvJHtzeW1ib2x9YCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xyXG4gICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHJlc3BvbnNlLmRhdGEuYmlkKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZmV0Y2ggcHJpY2UnKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIFRyYWRlTG9ja2VyIHByaWNlOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgaGlzdG9yaWNhbCBkYXRhXHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0SGlzdG9yaWNhbERhdGEoc3ltYm9sOiBzdHJpbmcsIHRpbWVmcmFtZTogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gMTAwKTogUHJvbWlzZTxhbnlbXT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCdHRVQnLCBgL3YxL2NoYXJ0cy8ke3N5bWJvbH1gLCB7XHJcbiAgICAgICAgdGltZWZyYW1lLFxyXG4gICAgICAgIGxpbWl0XHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5tYXAoKGNhbmRsZTogYW55KSA9PiAoe1xyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZShjYW5kbGUudGltZXN0YW1wKSxcclxuICAgICAgICAgIG9wZW46IHBhcnNlRmxvYXQoY2FuZGxlLm9wZW4pLFxyXG4gICAgICAgICAgaGlnaDogcGFyc2VGbG9hdChjYW5kbGUuaGlnaCksXHJcbiAgICAgICAgICBsb3c6IHBhcnNlRmxvYXQoY2FuZGxlLmxvdyksXHJcbiAgICAgICAgICBjbG9zZTogcGFyc2VGbG9hdChjYW5kbGUuY2xvc2UpLFxyXG4gICAgICAgICAgdm9sdW1lOiBwYXJzZUZsb2F0KGNhbmRsZS52b2x1bWUpXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBoaXN0b3JpY2FsIGRhdGEnKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIFRyYWRlTG9ja2VyIGhpc3RvcmljYWwgZGF0YTonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGxhY2UgYSBtYXJrZXQgb3JkZXJcclxuICAgKi9cclxuICBhc3luYyBwbGFjZU1hcmtldE9yZGVyKG9yZGVyOiBUcmFkZUxvY2tlck9yZGVyKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG9yZGVyRGF0YSA9IHtcclxuICAgICAgICBzeW1ib2w6IG9yZGVyLnN5bWJvbCxcclxuICAgICAgICBzaWRlOiBvcmRlci5zaWRlLFxyXG4gICAgICAgIHR5cGU6ICdtYXJrZXQnLFxyXG4gICAgICAgIHF1YW50aXR5OiBvcmRlci5xdWFudGl0eSxcclxuICAgICAgICB0aW1lSW5Gb3JjZTogb3JkZXIudGltZUluRm9yY2UgfHwgJ0dUQydcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnUE9TVCcsIGAvdjEvYWNjb3VudHMvJHt0aGlzLmNvbmZpZy5hY2NvdW50SWR9L29yZGVyc2AsIG9yZGVyRGF0YSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xyXG4gICAgICAgIC8vIElmIHN0b3AgbG9zcyBhbmQgdGFrZSBwcm9maXQgYXJlIHNwZWNpZmllZCwgYWRkIHRoZW1cclxuICAgICAgICBpZiAob3JkZXIuc3RvcExvc3MgfHwgb3JkZXIudGFrZVByb2ZpdCkge1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5hZGRTdG9wTG9zc1Rha2VQcm9maXQocmVzcG9uc2UuZGF0YS5vcmRlcklkLCBvcmRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgb3JkZXJJZDogcmVzcG9uc2UuZGF0YS5vcmRlcklkLFxyXG4gICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5kYXRhLnN0YXR1cyxcclxuICAgICAgICAgIGZpbGxlZFF1YW50aXR5OiByZXNwb25zZS5kYXRhLmZpbGxlZFF1YW50aXR5LFxyXG4gICAgICAgICAgYXZlcmFnZVByaWNlOiByZXNwb25zZS5kYXRhLmF2ZXJhZ2VQcmljZVxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHBsYWNlIG9yZGVyJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwbGFjaW5nIFRyYWRlTG9ja2VyIG9yZGVyOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQbGFjZSBhIGxpbWl0IG9yZGVyXHJcbiAgICovXHJcbiAgYXN5bmMgcGxhY2VMaW1pdE9yZGVyKG9yZGVyOiBUcmFkZUxvY2tlck9yZGVyKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghb3JkZXIucHJpY2UpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ByaWNlIGlzIHJlcXVpcmVkIGZvciBsaW1pdCBvcmRlcnMnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3Qgb3JkZXJEYXRhID0ge1xyXG4gICAgICAgIHN5bWJvbDogb3JkZXIuc3ltYm9sLFxyXG4gICAgICAgIHNpZGU6IG9yZGVyLnNpZGUsXHJcbiAgICAgICAgdHlwZTogJ2xpbWl0JyxcclxuICAgICAgICBxdWFudGl0eTogb3JkZXIucXVhbnRpdHksXHJcbiAgICAgICAgcHJpY2U6IG9yZGVyLnByaWNlLFxyXG4gICAgICAgIHRpbWVJbkZvcmNlOiBvcmRlci50aW1lSW5Gb3JjZSB8fCAnR1RDJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCdQT1NUJywgYC92MS9hY2NvdW50cy8ke3RoaXMuY29uZmlnLmFjY291bnRJZH0vb3JkZXJzYCwgb3JkZXJEYXRhKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgLy8gSWYgc3RvcCBsb3NzIGFuZCB0YWtlIHByb2ZpdCBhcmUgc3BlY2lmaWVkLCBhZGQgdGhlbVxyXG4gICAgICAgIGlmIChvcmRlci5zdG9wTG9zcyB8fCBvcmRlci50YWtlUHJvZml0KSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmFkZFN0b3BMb3NzVGFrZVByb2ZpdChyZXNwb25zZS5kYXRhLm9yZGVySWQsIG9yZGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICBvcmRlcklkOiByZXNwb25zZS5kYXRhLm9yZGVySWQsXHJcbiAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLmRhdGEuc3RhdHVzXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcGxhY2UgbGltaXQgb3JkZXInKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHBsYWNpbmcgVHJhZGVMb2NrZXIgbGltaXQgb3JkZXI6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZCBzdG9wIGxvc3MgYW5kIHRha2UgcHJvZml0IHRvIGFuIGV4aXN0aW5nIHBvc2l0aW9uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBhZGRTdG9wTG9zc1Rha2VQcm9maXQob3JkZXJJZDogc3RyaW5nLCBvcmRlcjogVHJhZGVMb2NrZXJPcmRlcik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKG9yZGVyLnN0b3BMb3NzKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnUE9TVCcsIGAvdjEvYWNjb3VudHMvJHt0aGlzLmNvbmZpZy5hY2NvdW50SWR9L3Bvc2l0aW9ucy8ke29yZGVySWR9L3N0b3AtbG9zc2AsIHtcclxuICAgICAgICAgIHByaWNlOiBvcmRlci5zdG9wTG9zc1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAob3JkZXIudGFrZVByb2ZpdCkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMubWFrZVJlcXVlc3QoJ1BPU1QnLCBgL3YxL2FjY291bnRzLyR7dGhpcy5jb25maWcuYWNjb3VudElkfS9wb3NpdGlvbnMvJHtvcmRlcklkfS90YWtlLXByb2ZpdGAsIHtcclxuICAgICAgICAgIHByaWNlOiBvcmRlci50YWtlUHJvZml0XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFkZGluZyBzdG9wIGxvc3MvdGFrZSBwcm9maXQ6JywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2xvc2UgYSBwb3NpdGlvblxyXG4gICAqL1xyXG4gIGFzeW5jIGNsb3NlUG9zaXRpb24oc3ltYm9sOiBzdHJpbmcsIHF1YW50aXR5PzogbnVtYmVyKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IGF3YWl0IHRoaXMuZ2V0UG9zaXRpb25zKCk7XHJcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gcG9zaXRpb25zLmZpbmQocCA9PiBwLnN5bWJvbCA9PT0gc3ltYm9sKTtcclxuICAgICAgXHJcbiAgICAgIGlmICghcG9zaXRpb24pIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bvc2l0aW9uIG5vdCBmb3VuZCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBjbG9zZVF1YW50aXR5ID0gcXVhbnRpdHkgfHwgcG9zaXRpb24ucXVhbnRpdHk7XHJcbiAgICAgIGNvbnN0IHNpZGUgPSBwb3NpdGlvbi5zaWRlID09PSAnbG9uZycgPyAnc2VsbCcgOiAnYnV5JztcclxuXHJcbiAgICAgIGNvbnN0IG9yZGVyRGF0YSA9IHtcclxuICAgICAgICBzeW1ib2w6IHN5bWJvbCxcclxuICAgICAgICBzaWRlOiBzaWRlLFxyXG4gICAgICAgIHR5cGU6ICdtYXJrZXQnLFxyXG4gICAgICAgIHF1YW50aXR5OiBjbG9zZVF1YW50aXR5LFxyXG4gICAgICAgIHRpbWVJbkZvcmNlOiAnSU9DJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCdQT1NUJywgYC92MS9hY2NvdW50cy8ke3RoaXMuY29uZmlnLmFjY291bnRJZH0vb3JkZXJzYCwgb3JkZXJEYXRhKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICBvcmRlcklkOiByZXNwb25zZS5kYXRhLm9yZGVySWQsXHJcbiAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLmRhdGEuc3RhdHVzLFxyXG4gICAgICAgICAgY2xvc2VkUXVhbnRpdHk6IGNsb3NlUXVhbnRpdHlcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBjbG9zZSBwb3NpdGlvbicpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2xvc2luZyBUcmFkZUxvY2tlciBwb3NpdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IG9wZW4gcG9zaXRpb25zXHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0UG9zaXRpb25zKCk6IFByb21pc2U8VHJhZGVMb2NrZXJQb3NpdGlvbltdPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3QoJ0dFVCcsIGAvdjEvYWNjb3VudHMvJHt0aGlzLmNvbmZpZy5hY2NvdW50SWR9L3Bvc2l0aW9uc2ApO1xyXG4gICAgICBcclxuICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5tYXAoKHBvc2l0aW9uOiBhbnkpID0+ICh7XHJcbiAgICAgICAgICBpZDogcG9zaXRpb24uaWQsXHJcbiAgICAgICAgICBzeW1ib2w6IHBvc2l0aW9uLnN5bWJvbCxcclxuICAgICAgICAgIHNpZGU6IHBvc2l0aW9uLnNpZGUsXHJcbiAgICAgICAgICBxdWFudGl0eTogcGFyc2VGbG9hdChwb3NpdGlvbi5xdWFudGl0eSksXHJcbiAgICAgICAgICBlbnRyeVByaWNlOiBwYXJzZUZsb2F0KHBvc2l0aW9uLmVudHJ5UHJpY2UpLFxyXG4gICAgICAgICAgY3VycmVudFByaWNlOiBwYXJzZUZsb2F0KHBvc2l0aW9uLmN1cnJlbnRQcmljZSksXHJcbiAgICAgICAgICB1bnJlYWxpemVkUG5MOiBwYXJzZUZsb2F0KHBvc2l0aW9uLnVucmVhbGl6ZWRQbkwpLFxyXG4gICAgICAgICAgc3RvcExvc3M6IHBvc2l0aW9uLnN0b3BMb3NzID8gcGFyc2VGbG9hdChwb3NpdGlvbi5zdG9wTG9zcykgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICB0YWtlUHJvZml0OiBwb3NpdGlvbi50YWtlUHJvZml0ID8gcGFyc2VGbG9hdChwb3NpdGlvbi50YWtlUHJvZml0KSA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUocG9zaXRpb24udGltZXN0YW1wKVxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZmV0Y2ggcG9zaXRpb25zJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBUcmFkZUxvY2tlciBwb3NpdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBvcmRlciBoaXN0b3J5XHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0T3JkZXJIaXN0b3J5KHN5bWJvbD86IHN0cmluZywgbGltaXQ6IG51bWJlciA9IDEwMCk6IFByb21pc2U8YW55W10+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcclxuICAgICAgaWYgKHN5bWJvbCkgcGFyYW1zLmFwcGVuZCgnc3ltYm9sJywgc3ltYm9sKTtcclxuICAgICAgcGFyYW1zLmFwcGVuZCgnbGltaXQnLCBsaW1pdC50b1N0cmluZygpKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnR0VUJywgYC92MS9hY2NvdW50cy8ke3RoaXMuY29uZmlnLmFjY291bnRJZH0vb3JkZXJzPyR7cGFyYW1zfWApO1xyXG4gICAgICBcclxuICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5tYXAoKG9yZGVyOiBhbnkpID0+ICh7XHJcbiAgICAgICAgICBpZDogb3JkZXIuaWQsXHJcbiAgICAgICAgICBzeW1ib2w6IG9yZGVyLnN5bWJvbCxcclxuICAgICAgICAgIHNpZGU6IG9yZGVyLnNpZGUsXHJcbiAgICAgICAgICB0eXBlOiBvcmRlci50eXBlLFxyXG4gICAgICAgICAgcXVhbnRpdHk6IHBhcnNlRmxvYXQob3JkZXIucXVhbnRpdHkpLFxyXG4gICAgICAgICAgcHJpY2U6IHBhcnNlRmxvYXQob3JkZXIucHJpY2UpLFxyXG4gICAgICAgICAgc3RhdHVzOiBvcmRlci5zdGF0dXMsXHJcbiAgICAgICAgICBmaWxsZWRRdWFudGl0eTogcGFyc2VGbG9hdChvcmRlci5maWxsZWRRdWFudGl0eSksXHJcbiAgICAgICAgICBhdmVyYWdlUHJpY2U6IHBhcnNlRmxvYXQob3JkZXIuYXZlcmFnZVByaWNlKSxcclxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUob3JkZXIudGltZXN0YW1wKVxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZmV0Y2ggb3JkZXIgaGlzdG9yeScpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgVHJhZGVMb2NrZXIgb3JkZXIgaGlzdG9yeTonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FuY2VsIGFuIG9yZGVyXHJcbiAgICovXHJcbiAgYXN5bmMgY2FuY2VsT3JkZXIob3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnREVMRVRFJywgYC92MS9hY2NvdW50cy8ke3RoaXMuY29uZmlnLmFjY291bnRJZH0vb3JkZXJzLyR7b3JkZXJJZH1gKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICBvcmRlcklkOiBvcmRlcklkLFxyXG4gICAgICAgICAgc3RhdHVzOiAnY2FuY2VsbGVkJ1xyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNhbmNlbCBvcmRlcicpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2FuY2VsbGluZyBUcmFkZUxvY2tlciBvcmRlcjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFrZSBhdXRoZW50aWNhdGVkIHJlcXVlc3QgdG8gVHJhZGVMb2NrZXIgQVBJXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBtYWtlUmVxdWVzdChtZXRob2Q6IHN0cmluZywgZW5kcG9pbnQ6IHN0cmluZywgZGF0YT86IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9JHtlbmRwb2ludH1gO1xyXG4gICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKS50b1N0cmluZygpO1xyXG4gICAgXHJcbiAgICAvLyBDcmVhdGUgc2lnbmF0dXJlIGZvciBhdXRoZW50aWNhdGlvblxyXG4gICAgY29uc3Qgc2lnbmF0dXJlID0gdGhpcy5jcmVhdGVTaWduYXR1cmUobWV0aG9kLCBlbmRwb2ludCwgdGltZXN0YW1wLCBkYXRhKTtcclxuICAgIFxyXG4gICAgY29uc3QgaGVhZGVyczogYW55ID0ge1xyXG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAnWC1BUEktS2V5JzogdGhpcy5jb25maWcuYXBpS2V5LFxyXG4gICAgICAnWC1UaW1lc3RhbXAnOiB0aW1lc3RhbXAsXHJcbiAgICAgICdYLVNpZ25hdHVyZSc6IHNpZ25hdHVyZVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByZXF1ZXN0T3B0aW9uczogYW55ID0ge1xyXG4gICAgICBtZXRob2QsXHJcbiAgICAgIGhlYWRlcnNcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGRhdGEgJiYgbWV0aG9kICE9PSAnR0VUJykge1xyXG4gICAgICByZXF1ZXN0T3B0aW9ucy5ib2R5ID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHJlcXVlc3RPcHRpb25zKTtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuXHJcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVHJhZGVMb2NrZXIgQVBJIGVycm9yOiAke3Jlc3VsdC5tZXNzYWdlIHx8IHJlc3BvbnNlLnN0YXR1c1RleHR9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBzaWduYXR1cmUgZm9yIEFQSSBhdXRoZW50aWNhdGlvblxyXG4gICAqL1xyXG4gIHByaXZhdGUgY3JlYXRlU2lnbmF0dXJlKG1ldGhvZDogc3RyaW5nLCBlbmRwb2ludDogc3RyaW5nLCB0aW1lc3RhbXA6IHN0cmluZywgZGF0YT86IGFueSk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBtZXNzYWdlID0gYCR7bWV0aG9kfSR7ZW5kcG9pbnR9JHt0aW1lc3RhbXB9JHtkYXRhID8gSlNPTi5zdHJpbmdpZnkoZGF0YSkgOiAnJ31gO1xyXG4gICAgXHJcbiAgICAvLyBVc2UgY3J5cHRvLWpzIG9yIHNpbWlsYXIgbGlicmFyeSBmb3IgSE1BQy1TSEEyNTZcclxuICAgIC8vIEZvciBub3csIHdlJ2xsIHVzZSBhIHNpbXBsZSBoYXNoICh5b3Ugc2hvdWxkIGltcGxlbWVudCBwcm9wZXIgSE1BQylcclxuICAgIGNvbnN0IGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpO1xyXG4gICAgcmV0dXJuIGNyeXB0by5jcmVhdGVIbWFjKCdzaGEyNTYnLCB0aGlzLmNvbmZpZy5zZWNyZXRLZXkpLnVwZGF0ZShtZXNzYWdlKS5kaWdlc3QoJ2hleCcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2F2ZSBicm9rZXIgY29uZmlndXJhdGlvbiB0byBkYXRhYmFzZVxyXG4gICAqL1xyXG4gIGFzeW5jIHNhdmVDb25maWcoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5icm9rZXJDb25maWcudXBzZXJ0KHtcclxuICAgICAgICB3aGVyZTogeyBicm9rZXI6ICd0cmFkZWxvY2tlcicgfSxcclxuICAgICAgICB1cGRhdGU6IHtcclxuICAgICAgICAgIGFwaUtleTogdGhpcy5jb25maWcuYXBpS2V5LFxyXG4gICAgICAgICAgc2VjcmV0S2V5OiB0aGlzLmNvbmZpZy5zZWNyZXRLZXksXHJcbiAgICAgICAgICBhY2NvdW50SWQ6IHRoaXMuY29uZmlnLmFjY291bnRJZCxcclxuICAgICAgICAgIGJhc2VVcmw6IHRoaXMuY29uZmlnLmJhc2VVcmwsXHJcbiAgICAgICAgICBlbnZpcm9ubWVudDogdGhpcy5jb25maWcuZW52aXJvbm1lbnRcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNyZWF0ZToge1xyXG4gICAgICAgICAgYnJva2VyOiAndHJhZGVsb2NrZXInLFxyXG4gICAgICAgICAgYXBpS2V5OiB0aGlzLmNvbmZpZy5hcGlLZXksXHJcbiAgICAgICAgICBzZWNyZXRLZXk6IHRoaXMuY29uZmlnLnNlY3JldEtleSxcclxuICAgICAgICAgIGFjY291bnRJZDogdGhpcy5jb25maWcuYWNjb3VudElkLFxyXG4gICAgICAgICAgYmFzZVVybDogdGhpcy5jb25maWcuYmFzZVVybCxcclxuICAgICAgICAgIGVudmlyb25tZW50OiB0aGlzLmNvbmZpZy5lbnZpcm9ubWVudFxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgVHJhZGVMb2NrZXIgY29uZmlnOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2FkIGJyb2tlciBjb25maWd1cmF0aW9uIGZyb20gZGF0YWJhc2VcclxuICAgKi9cclxuICBhc3luYyBsb2FkQ29uZmlnKCk6IFByb21pc2U8VHJhZGVMb2NrZXJDb25maWcgfCBudWxsPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBjb25maWcgPSBhd2FpdCB0aGlzLnByaXNtYS5icm9rZXJDb25maWcuZmluZFVuaXF1ZSh7XHJcbiAgICAgICAgd2hlcmU6IHsgYnJva2VyOiAndHJhZGVsb2NrZXInIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5jb25maWcgPSB7XHJcbiAgICAgICAgICBhcGlLZXk6IGNvbmZpZy5hcGlLZXksXHJcbiAgICAgICAgICBzZWNyZXRLZXk6IGNvbmZpZy5zZWNyZXRLZXksXHJcbiAgICAgICAgICBhY2NvdW50SWQ6IGNvbmZpZy5hY2NvdW50SWQsXHJcbiAgICAgICAgICBiYXNlVXJsOiBjb25maWcuYmFzZVVybCxcclxuICAgICAgICAgIGVudmlyb25tZW50OiBjb25maWcuZW52aXJvbm1lbnQgYXMgJ2RlbW8nIHwgJ2xpdmUnXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb25maWc7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBUcmFkZUxvY2tlciBjb25maWc6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJvdC1vcHRpbWl6ZWQgbWFya2V0IG9yZGVyIHBsYWNlbWVudFxyXG4gICAqL1xyXG4gIGFzeW5jIHBsYWNlQm90TWFya2V0T3JkZXIob3JkZXI6IFRyYWRlTG9ja2VyT3JkZXIpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgdGhpcy5yYXRlTGltaXQoKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IG9yZGVyRGF0YSA9IHtcclxuICAgICAgICBzeW1ib2w6IG9yZGVyLnN5bWJvbCxcclxuICAgICAgICBzaWRlOiBvcmRlci5zaWRlLFxyXG4gICAgICAgIHR5cGU6ICdtYXJrZXQnLFxyXG4gICAgICAgIHF1YW50aXR5OiBvcmRlci5xdWFudGl0eSxcclxuICAgICAgICB0aW1lSW5Gb3JjZTogb3JkZXIudGltZUluRm9yY2UgfHwgJ0lPQycgLy8gSW1tZWRpYXRlIG9yIENhbmNlbCBmb3IgYm90c1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCdQT1NUJywgYC92MS9hY2NvdW50cy8ke3RoaXMuY29uZmlnLmFjY291bnRJZH0vb3JkZXJzYCwgb3JkZXJEYXRhKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgLy8gTG9nIHN1Y2Nlc3NmdWwgYm90IHRyYWRlXHJcbiAgICAgICAgY29uc29sZS5sb2coYEJvdCBUcmFkZSBFeGVjdXRlZDogJHtvcmRlci5zaWRlfSAke29yZGVyLnF1YW50aXR5fSAke29yZGVyLnN5bWJvbH0gYXQgbWFya2V0YCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gSWYgc3RvcCBsb3NzIGFuZCB0YWtlIHByb2ZpdCBhcmUgc3BlY2lmaWVkLCBhZGQgdGhlbVxyXG4gICAgICAgIGlmIChvcmRlci5zdG9wTG9zcyB8fCBvcmRlci50YWtlUHJvZml0KSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmFkZFN0b3BMb3NzVGFrZVByb2ZpdChyZXNwb25zZS5kYXRhLm9yZGVySWQsIG9yZGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICBvcmRlcklkOiByZXNwb25zZS5kYXRhLm9yZGVySWQsXHJcbiAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLmRhdGEuc3RhdHVzLFxyXG4gICAgICAgICAgZmlsbGVkUXVhbnRpdHk6IHJlc3BvbnNlLmRhdGEuZmlsbGVkUXVhbnRpdHksXHJcbiAgICAgICAgICBhdmVyYWdlUHJpY2U6IHJlc3BvbnNlLmRhdGEuYXZlcmFnZVByaWNlLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcGxhY2UgYm90IG9yZGVyJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUJvdFRyYWRpbmdFcnJvcihlcnJvciwgJ21hcmtldCBvcmRlcicpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQm90LW9wdGltaXplZCBsaW1pdCBvcmRlciBwbGFjZW1lbnRcclxuICAgKi9cclxuICBhc3luYyBwbGFjZUJvdExpbWl0T3JkZXIob3JkZXI6IFRyYWRlTG9ja2VyT3JkZXIpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgdGhpcy5yYXRlTGltaXQoKTtcclxuICAgICAgXHJcbiAgICAgIGlmICghb3JkZXIucHJpY2UpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ByaWNlIGlzIHJlcXVpcmVkIGZvciBsaW1pdCBvcmRlcnMnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3Qgb3JkZXJEYXRhID0ge1xyXG4gICAgICAgIHN5bWJvbDogb3JkZXIuc3ltYm9sLFxyXG4gICAgICAgIHNpZGU6IG9yZGVyLnNpZGUsXHJcbiAgICAgICAgdHlwZTogJ2xpbWl0JyxcclxuICAgICAgICBxdWFudGl0eTogb3JkZXIucXVhbnRpdHksXHJcbiAgICAgICAgcHJpY2U6IG9yZGVyLnByaWNlLFxyXG4gICAgICAgIHRpbWVJbkZvcmNlOiBvcmRlci50aW1lSW5Gb3JjZSB8fCAnR1RDJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCdQT1NUJywgYC92MS9hY2NvdW50cy8ke3RoaXMuY29uZmlnLmFjY291bnRJZH0vb3JkZXJzYCwgb3JkZXJEYXRhKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYEJvdCBMaW1pdCBPcmRlciBQbGFjZWQ6ICR7b3JkZXIuc2lkZX0gJHtvcmRlci5xdWFudGl0eX0gJHtvcmRlci5zeW1ib2x9IGF0ICR7b3JkZXIucHJpY2V9YCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKG9yZGVyLnN0b3BMb3NzIHx8IG9yZGVyLnRha2VQcm9maXQpIHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuYWRkU3RvcExvc3NUYWtlUHJvZml0KHJlc3BvbnNlLmRhdGEub3JkZXJJZCwgb3JkZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgIG9yZGVySWQ6IHJlc3BvbnNlLmRhdGEub3JkZXJJZCxcclxuICAgICAgICAgIHN0YXR1czogcmVzcG9uc2UuZGF0YS5zdGF0dXMsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBwbGFjZSBib3QgbGltaXQgb3JkZXInKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlQm90VHJhZGluZ0Vycm9yKGVycm9yLCAnbGltaXQgb3JkZXInKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJvdC1vcHRpbWl6ZWQgcG9zaXRpb24gY2xvc2luZ1xyXG4gICAqL1xyXG4gIGFzeW5jIGNsb3NlQm90UG9zaXRpb24oc3ltYm9sOiBzdHJpbmcsIHF1YW50aXR5PzogbnVtYmVyKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHRoaXMucmF0ZUxpbWl0KCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBwb3NpdGlvbnMgPSBhd2FpdCB0aGlzLmdldFBvc2l0aW9ucygpO1xyXG4gICAgICBjb25zdCBwb3NpdGlvbiA9IHBvc2l0aW9ucy5maW5kKHAgPT4gcC5zeW1ib2wgPT09IHN5bWJvbCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIXBvc2l0aW9uKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQb3NpdGlvbiBub3QgZm91bmQgZm9yIGJvdCB0byBjbG9zZScpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBjbG9zZVF1YW50aXR5ID0gcXVhbnRpdHkgfHwgcG9zaXRpb24ucXVhbnRpdHk7XHJcbiAgICAgIGNvbnN0IHNpZGUgPSBwb3NpdGlvbi5zaWRlID09PSAnbG9uZycgPyAnc2VsbCcgOiAnYnV5JztcclxuXHJcbiAgICAgIGNvbnN0IG9yZGVyRGF0YSA9IHtcclxuICAgICAgICBzeW1ib2w6IHN5bWJvbCxcclxuICAgICAgICBzaWRlOiBzaWRlLFxyXG4gICAgICAgIHR5cGU6ICdtYXJrZXQnLFxyXG4gICAgICAgIHF1YW50aXR5OiBjbG9zZVF1YW50aXR5LFxyXG4gICAgICAgIHRpbWVJbkZvcmNlOiAnSU9DJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCdQT1NUJywgYC92MS9hY2NvdW50cy8ke3RoaXMuY29uZmlnLmFjY291bnRJZH0vb3JkZXJzYCwgb3JkZXJEYXRhKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYEJvdCBQb3NpdGlvbiBDbG9zZWQ6ICR7Y2xvc2VRdWFudGl0eX0gJHtzeW1ib2x9YCk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICBvcmRlcklkOiByZXNwb25zZS5kYXRhLm9yZGVySWQsXHJcbiAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLmRhdGEuc3RhdHVzLFxyXG4gICAgICAgICAgY2xvc2VkUXVhbnRpdHk6IGNsb3NlUXVhbnRpdHksXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBjbG9zZSBib3QgcG9zaXRpb24nKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlQm90VHJhZGluZ0Vycm9yKGVycm9yLCAncG9zaXRpb24gY2xvc2UnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhY2NvdW50IGJhbGFuY2UgZm9yIGJvdCByaXNrIG1hbmFnZW1lbnRcclxuICAgKi9cclxuICBhc3luYyBnZXRCb3RCYWxhbmNlKCk6IFByb21pc2U8VHJhZGVMb2NrZXJCYWxhbmNlW10+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHRoaXMucmF0ZUxpbWl0KCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3QoJ0dFVCcsIGAvdjEvYWNjb3VudHMvJHt0aGlzLmNvbmZpZy5hY2NvdW50SWR9L2JhbGFuY2VgKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEubWFwKChiYWxhbmNlOiBhbnkpID0+ICh7XHJcbiAgICAgICAgICBjdXJyZW5jeTogYmFsYW5jZS5jdXJyZW5jeSxcclxuICAgICAgICAgIGJhbGFuY2U6IHBhcnNlRmxvYXQoYmFsYW5jZS5iYWxhbmNlKSxcclxuICAgICAgICAgIGVxdWl0eTogcGFyc2VGbG9hdChiYWxhbmNlLmVxdWl0eSksXHJcbiAgICAgICAgICBtYXJnaW46IHBhcnNlRmxvYXQoYmFsYW5jZS5tYXJnaW4pLFxyXG4gICAgICAgICAgZnJlZU1hcmdpbjogcGFyc2VGbG9hdChiYWxhbmNlLmZyZWVNYXJnaW4pLFxyXG4gICAgICAgICAgbWFyZ2luTGV2ZWw6IHBhcnNlRmxvYXQoYmFsYW5jZS5tYXJnaW5MZXZlbClcclxuICAgICAgICB9KSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGZldGNoIGJvdCBiYWxhbmNlJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUJvdFRyYWRpbmdFcnJvcihlcnJvciwgJ2JhbGFuY2UgZmV0Y2gnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrIGlmIGJvdCBjYW4gcGxhY2UgdHJhZGUgKHJpc2sgbWFuYWdlbWVudClcclxuICAgKi9cclxuICBhc3luYyBjYW5Cb3RUcmFkZShzeW1ib2w6IHN0cmluZywgcXVhbnRpdHk6IG51bWJlciwgc2lkZTogJ2J1eScgfCAnc2VsbCcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHRoaXMucmF0ZUxpbWl0KCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBHZXQgY3VycmVudCBiYWxhbmNlXHJcbiAgICAgIGNvbnN0IGJhbGFuY2UgPSBhd2FpdCB0aGlzLmdldEJvdEJhbGFuY2UoKTtcclxuICAgICAgY29uc3QgdXNkQmFsYW5jZSA9IGJhbGFuY2UuZmluZChiID0+IGIuY3VycmVuY3kgPT09ICdVU0QnKTtcclxuICAgICAgXHJcbiAgICAgIGlmICghdXNkQmFsYW5jZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0JvdDogTm8gVVNEIGJhbGFuY2UgZm91bmQnKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIEdldCBjdXJyZW50IHByaWNlXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRQcmljZSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudFByaWNlKHN5bWJvbCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDYWxjdWxhdGUgcmVxdWlyZWQgbWFyZ2luIChhc3N1bWluZyAxOjEwMCBsZXZlcmFnZSlcclxuICAgICAgY29uc3QgcmVxdWlyZWRNYXJnaW4gPSAocXVhbnRpdHkgKiBjdXJyZW50UHJpY2UpIC8gMTAwO1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgd2UgaGF2ZSBlbm91Z2ggZnJlZSBtYXJnaW5cclxuICAgICAgaWYgKHVzZEJhbGFuY2UuZnJlZU1hcmdpbiA8IHJlcXVpcmVkTWFyZ2luKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgQm90OiBJbnN1ZmZpY2llbnQgbWFyZ2luLiBSZXF1aXJlZDogJHtyZXF1aXJlZE1hcmdpbn0sIEF2YWlsYWJsZTogJHt1c2RCYWxhbmNlLmZyZWVNYXJnaW59YCk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBtYXJnaW4gbGV2ZWwgKHNob3VsZCBiZSBhYm92ZSAyMDAlIGZvciBzYWZldHkpXHJcbiAgICAgIGlmICh1c2RCYWxhbmNlLm1hcmdpbkxldmVsIDwgMjAwKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgQm90OiBNYXJnaW4gbGV2ZWwgdG9vIGxvdzogJHt1c2RCYWxhbmNlLm1hcmdpbkxldmVsfSVgKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdCb3Q6IEVycm9yIGNoZWNraW5nIHRyYWRlIGZlYXNpYmlsaXR5OicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHBvc2l0aW9ucyBmb3IgYm90IG1vbml0b3JpbmdcclxuICAgKi9cclxuICBhc3luYyBnZXRCb3RQb3NpdGlvbnMoKTogUHJvbWlzZTxUcmFkZUxvY2tlclBvc2l0aW9uW10+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHRoaXMucmF0ZUxpbWl0KCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3QoJ0dFVCcsIGAvdjEvYWNjb3VudHMvJHt0aGlzLmNvbmZpZy5hY2NvdW50SWR9L3Bvc2l0aW9uc2ApO1xyXG4gICAgICBcclxuICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5tYXAoKHBvc2l0aW9uOiBhbnkpID0+ICh7XHJcbiAgICAgICAgICBpZDogcG9zaXRpb24uaWQsXHJcbiAgICAgICAgICBzeW1ib2w6IHBvc2l0aW9uLnN5bWJvbCxcclxuICAgICAgICAgIHNpZGU6IHBvc2l0aW9uLnNpZGUsXHJcbiAgICAgICAgICBxdWFudGl0eTogcGFyc2VGbG9hdChwb3NpdGlvbi5xdWFudGl0eSksXHJcbiAgICAgICAgICBlbnRyeVByaWNlOiBwYXJzZUZsb2F0KHBvc2l0aW9uLmVudHJ5UHJpY2UpLFxyXG4gICAgICAgICAgY3VycmVudFByaWNlOiBwYXJzZUZsb2F0KHBvc2l0aW9uLmN1cnJlbnRQcmljZSksXHJcbiAgICAgICAgICB1bnJlYWxpemVkUG5MOiBwYXJzZUZsb2F0KHBvc2l0aW9uLnVucmVhbGl6ZWRQbkwpLFxyXG4gICAgICAgICAgc3RvcExvc3M6IHBvc2l0aW9uLnN0b3BMb3NzID8gcGFyc2VGbG9hdChwb3NpdGlvbi5zdG9wTG9zcykgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICB0YWtlUHJvZml0OiBwb3NpdGlvbi50YWtlUHJvZml0ID8gcGFyc2VGbG9hdChwb3NpdGlvbi50YWtlUHJvZml0KSA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUocG9zaXRpb24udGltZXN0YW1wKVxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZmV0Y2ggYm90IHBvc2l0aW9ucycpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVCb3RUcmFkaW5nRXJyb3IoZXJyb3IsICdwb3NpdGlvbnMgZmV0Y2gnKTtcclxuICAgIH1cclxuICB9XHJcbn0gIl0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsIlRyYWRlTG9ja2VyQVBJIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJsYXN0UmVxdWVzdFRpbWUiLCJtaW5SZXF1ZXN0SW50ZXJ2YWwiLCJwcmlzbWEiLCJiYXNlVXJsIiwicmF0ZUxpbWl0Iiwibm93IiwiRGF0ZSIsInRpbWVTaW5jZUxhc3RSZXF1ZXN0IiwiZGVsYXkiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJoYW5kbGVCb3RUcmFkaW5nRXJyb3IiLCJlcnJvciIsIm9wZXJhdGlvbiIsImNvbnNvbGUiLCJtZXNzYWdlIiwiaW5jbHVkZXMiLCJFcnJvciIsInRlc3RDb25uZWN0aW9uIiwicmVzcG9uc2UiLCJtYWtlUmVxdWVzdCIsInN1Y2Nlc3MiLCJnZXRCYWxhbmNlIiwiYWNjb3VudElkIiwiZGF0YSIsIm1hcCIsImJhbGFuY2UiLCJjdXJyZW5jeSIsInBhcnNlRmxvYXQiLCJlcXVpdHkiLCJtYXJnaW4iLCJmcmVlTWFyZ2luIiwibWFyZ2luTGV2ZWwiLCJnZXRDdXJyZW50UHJpY2UiLCJzeW1ib2wiLCJiaWQiLCJnZXRIaXN0b3JpY2FsRGF0YSIsInRpbWVmcmFtZSIsImxpbWl0IiwiY2FuZGxlIiwidGltZXN0YW1wIiwib3BlbiIsImhpZ2giLCJsb3ciLCJjbG9zZSIsInZvbHVtZSIsInBsYWNlTWFya2V0T3JkZXIiLCJvcmRlciIsIm9yZGVyRGF0YSIsInNpZGUiLCJ0eXBlIiwicXVhbnRpdHkiLCJ0aW1lSW5Gb3JjZSIsInN0b3BMb3NzIiwidGFrZVByb2ZpdCIsImFkZFN0b3BMb3NzVGFrZVByb2ZpdCIsIm9yZGVySWQiLCJzdGF0dXMiLCJmaWxsZWRRdWFudGl0eSIsImF2ZXJhZ2VQcmljZSIsInBsYWNlTGltaXRPcmRlciIsInByaWNlIiwiY2xvc2VQb3NpdGlvbiIsInBvc2l0aW9ucyIsImdldFBvc2l0aW9ucyIsInBvc2l0aW9uIiwiZmluZCIsInAiLCJjbG9zZVF1YW50aXR5IiwiY2xvc2VkUXVhbnRpdHkiLCJpZCIsImVudHJ5UHJpY2UiLCJjdXJyZW50UHJpY2UiLCJ1bnJlYWxpemVkUG5MIiwidW5kZWZpbmVkIiwiZ2V0T3JkZXJIaXN0b3J5IiwicGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwiYXBwZW5kIiwidG9TdHJpbmciLCJjYW5jZWxPcmRlciIsIm1ldGhvZCIsImVuZHBvaW50IiwidXJsIiwic2lnbmF0dXJlIiwiY3JlYXRlU2lnbmF0dXJlIiwiaGVhZGVycyIsImFwaUtleSIsInJlcXVlc3RPcHRpb25zIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJmZXRjaCIsInJlc3VsdCIsImpzb24iLCJvayIsInN0YXR1c1RleHQiLCJjcnlwdG8iLCJyZXF1aXJlIiwiY3JlYXRlSG1hYyIsInNlY3JldEtleSIsInVwZGF0ZSIsImRpZ2VzdCIsInNhdmVDb25maWciLCJicm9rZXJDb25maWciLCJ1cHNlcnQiLCJ3aGVyZSIsImJyb2tlciIsImVudmlyb25tZW50IiwiY3JlYXRlIiwibG9hZENvbmZpZyIsImZpbmRVbmlxdWUiLCJwbGFjZUJvdE1hcmtldE9yZGVyIiwibG9nIiwicGxhY2VCb3RMaW1pdE9yZGVyIiwiY2xvc2VCb3RQb3NpdGlvbiIsImdldEJvdEJhbGFuY2UiLCJjYW5Cb3RUcmFkZSIsInVzZEJhbGFuY2UiLCJiIiwicmVxdWlyZWRNYXJnaW4iLCJnZXRCb3RQb3NpdGlvbnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/tradelocker-api.ts\n");

/***/ }),

/***/ "(api)/./pages/api/broker/tradelocker.ts":
/*!*****************************************!*\
  !*** ./pages/api/broker/tradelocker.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/tradelocker-api */ \"(api)/./lib/tradelocker-api.ts\");\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    try {\n        const { action, config, order } = req.body;\n        switch(action){\n            case \"connect\":\n                return await handleConnect(req, res, config);\n            case \"test\":\n                return await handleTestConnection(req, res, config);\n            case \"balance\":\n                return await handleGetBalance(req, res, config);\n            case \"price\":\n                return await handleGetPrice(req, res, config);\n            case \"market_order\":\n                return await handleMarketOrder(req, res, config, order);\n            case \"limit_order\":\n                return await handleLimitOrder(req, res, config, order);\n            case \"positions\":\n                return await handleGetPositions(req, res, config);\n            case \"close_position\":\n                return await handleClosePosition(req, res, config, order);\n            case \"order_history\":\n                return await handleGetOrderHistory(req, res, config);\n            case \"cancel_order\":\n                return await handleCancelOrder(req, res, config, order);\n            default:\n                return res.status(400).json({\n                    error: \"Invalid action\"\n                });\n        }\n    } catch (error) {\n        console.error(\"TradeLocker API error:\", error);\n        return res.status(500).json({\n            error: \"Internal server error\",\n            details: error.message\n        });\n    }\n}\nasync function handleConnect(req, res, config) {\n    try {\n        const tradelocker = new _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__.TradeLockerAPI(config);\n        // Test the connection\n        const isConnected = await tradelocker.testConnection();\n        if (!isConnected) {\n            return res.status(400).json({\n                error: \"Failed to connect to TradeLocker\"\n            });\n        }\n        // Save the configuration\n        await tradelocker.saveConfig();\n        return res.status(200).json({\n            success: true,\n            message: \"Successfully connected to TradeLocker\"\n        });\n    } catch (error) {\n        return res.status(400).json({\n            error: error.message\n        });\n    }\n}\nasync function handleTestConnection(req, res, config) {\n    try {\n        const tradelocker = new _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__.TradeLockerAPI(config);\n        const isConnected = await tradelocker.testConnection();\n        return res.status(200).json({\n            success: isConnected,\n            message: isConnected ? \"Connection successful\" : \"Connection failed\"\n        });\n    } catch (error) {\n        return res.status(400).json({\n            error: error.message\n        });\n    }\n}\nasync function handleGetBalance(req, res, config) {\n    try {\n        const tradelocker = new _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__.TradeLockerAPI(config);\n        const balance = await tradelocker.getBalance();\n        return res.status(200).json({\n            success: true,\n            data: balance\n        });\n    } catch (error) {\n        return res.status(400).json({\n            error: error.message\n        });\n    }\n}\nasync function handleGetPrice(req, res, config) {\n    try {\n        const { symbol } = req.body;\n        if (!symbol) {\n            return res.status(400).json({\n                error: \"Symbol is required\"\n            });\n        }\n        const tradelocker = new _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__.TradeLockerAPI(config);\n        const price = await tradelocker.getCurrentPrice(symbol);\n        return res.status(200).json({\n            success: true,\n            data: {\n                symbol,\n                price\n            }\n        });\n    } catch (error) {\n        return res.status(400).json({\n            error: error.message\n        });\n    }\n}\nasync function handleMarketOrder(req, res, config, order) {\n    try {\n        const { symbol, side, quantity, stopLoss, takeProfit } = order;\n        if (!symbol || !side || !quantity) {\n            return res.status(400).json({\n                error: \"Symbol, side, and quantity are required\"\n            });\n        }\n        const tradelocker = new _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__.TradeLockerAPI(config);\n        const result = await tradelocker.placeMarketOrder({\n            symbol,\n            side,\n            type: \"market\",\n            quantity: parseFloat(quantity),\n            stopLoss: stopLoss ? parseFloat(stopLoss) : undefined,\n            takeProfit: takeProfit ? parseFloat(takeProfit) : undefined\n        });\n        return res.status(200).json({\n            success: true,\n            data: result\n        });\n    } catch (error) {\n        return res.status(400).json({\n            error: error.message\n        });\n    }\n}\nasync function handleLimitOrder(req, res, config, order) {\n    try {\n        const { symbol, side, quantity, price, stopLoss, takeProfit } = order;\n        if (!symbol || !side || !quantity || !price) {\n            return res.status(400).json({\n                error: \"Symbol, side, quantity, and price are required\"\n            });\n        }\n        const tradelocker = new _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__.TradeLockerAPI(config);\n        const result = await tradelocker.placeLimitOrder({\n            symbol,\n            side,\n            type: \"limit\",\n            quantity: parseFloat(quantity),\n            price: parseFloat(price),\n            stopLoss: stopLoss ? parseFloat(stopLoss) : undefined,\n            takeProfit: takeProfit ? parseFloat(takeProfit) : undefined\n        });\n        return res.status(200).json({\n            success: true,\n            data: result\n        });\n    } catch (error) {\n        return res.status(400).json({\n            error: error.message\n        });\n    }\n}\nasync function handleGetPositions(req, res, config) {\n    try {\n        const tradelocker = new _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__.TradeLockerAPI(config);\n        const positions = await tradelocker.getPositions();\n        return res.status(200).json({\n            success: true,\n            data: positions\n        });\n    } catch (error) {\n        return res.status(400).json({\n            error: error.message\n        });\n    }\n}\nasync function handleClosePosition(req, res, config, order) {\n    try {\n        const { symbol, quantity } = order;\n        if (!symbol) {\n            return res.status(400).json({\n                error: \"Symbol is required\"\n            });\n        }\n        const tradelocker = new _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__.TradeLockerAPI(config);\n        const result = await tradelocker.closePosition(symbol, quantity ? parseFloat(quantity) : undefined);\n        return res.status(200).json({\n            success: true,\n            data: result\n        });\n    } catch (error) {\n        return res.status(400).json({\n            error: error.message\n        });\n    }\n}\nasync function handleGetOrderHistory(req, res, config) {\n    try {\n        const { symbol, limit } = req.body;\n        const tradelocker = new _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__.TradeLockerAPI(config);\n        const history = await tradelocker.getOrderHistory(symbol, limit || 100);\n        return res.status(200).json({\n            success: true,\n            data: history\n        });\n    } catch (error) {\n        return res.status(400).json({\n            error: error.message\n        });\n    }\n}\nasync function handleCancelOrder(req, res, config, order) {\n    try {\n        const { orderId } = order;\n        if (!orderId) {\n            return res.status(400).json({\n                error: \"Order ID is required\"\n            });\n        }\n        const tradelocker = new _lib_tradelocker_api__WEBPACK_IMPORTED_MODULE_0__.TradeLockerAPI(config);\n        const result = await tradelocker.cancelOrder(orderId);\n        return res.status(200).json({\n            success: true,\n            data: result\n        });\n    } catch (error) {\n        return res.status(400).json({\n            error: error.message\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYnJva2VyL3RyYWRlbG9ja2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQ2lGO0FBRWxFLGVBQWVDLFFBQVFDLEdBQW1CLEVBQUVDLEdBQW9CO0lBQzdFLElBQUlELElBQUlFLE1BQU0sS0FBSyxRQUFRO1FBQ3pCLE9BQU9ELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFxQjtJQUM1RDtJQUVBLElBQUk7UUFDRixNQUFNLEVBQUVDLE1BQU0sRUFBRUMsTUFBTSxFQUFFQyxLQUFLLEVBQUUsR0FBR1IsSUFBSVMsSUFBSTtRQUUxQyxPQUFRSDtZQUNOLEtBQUs7Z0JBQ0gsT0FBTyxNQUFNSSxjQUFjVixLQUFLQyxLQUFLTTtZQUN2QyxLQUFLO2dCQUNILE9BQU8sTUFBTUkscUJBQXFCWCxLQUFLQyxLQUFLTTtZQUM5QyxLQUFLO2dCQUNILE9BQU8sTUFBTUssaUJBQWlCWixLQUFLQyxLQUFLTTtZQUMxQyxLQUFLO2dCQUNILE9BQU8sTUFBTU0sZUFBZWIsS0FBS0MsS0FBS007WUFDeEMsS0FBSztnQkFDSCxPQUFPLE1BQU1PLGtCQUFrQmQsS0FBS0MsS0FBS00sUUFBUUM7WUFDbkQsS0FBSztnQkFDSCxPQUFPLE1BQU1PLGlCQUFpQmYsS0FBS0MsS0FBS00sUUFBUUM7WUFDbEQsS0FBSztnQkFDSCxPQUFPLE1BQU1RLG1CQUFtQmhCLEtBQUtDLEtBQUtNO1lBQzVDLEtBQUs7Z0JBQ0gsT0FBTyxNQUFNVSxvQkFBb0JqQixLQUFLQyxLQUFLTSxRQUFRQztZQUNyRCxLQUFLO2dCQUNILE9BQU8sTUFBTVUsc0JBQXNCbEIsS0FBS0MsS0FBS007WUFDL0MsS0FBSztnQkFDSCxPQUFPLE1BQU1ZLGtCQUFrQm5CLEtBQUtDLEtBQUtNLFFBQVFDO1lBQ25EO2dCQUNFLE9BQU9QLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQUVDLE9BQU87Z0JBQWlCO1FBQzFEO0lBQ0YsRUFBRSxPQUFPQSxPQUFZO1FBQ25CZSxRQUFRZixLQUFLLENBQUMsMEJBQTBCQTtRQUN4QyxPQUFPSixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCQyxPQUFPO1lBQ1BnQixTQUFTaEIsTUFBTWlCLE9BQU87UUFDeEI7SUFDRjtBQUNGO0FBRUEsZUFBZVosY0FBY1YsR0FBbUIsRUFBRUMsR0FBb0IsRUFBRU0sTUFBeUI7SUFDL0YsSUFBSTtRQUNGLE1BQU1nQixjQUFjLElBQUl6QixnRUFBY0EsQ0FBQ1M7UUFFdkMsc0JBQXNCO1FBQ3RCLE1BQU1pQixjQUFjLE1BQU1ELFlBQVlFLGNBQWM7UUFFcEQsSUFBSSxDQUFDRCxhQUFhO1lBQ2hCLE9BQU92QixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQW1DO1FBQzFFO1FBRUEseUJBQXlCO1FBQ3pCLE1BQU1rQixZQUFZRyxVQUFVO1FBRTVCLE9BQU96QixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCdUIsU0FBUztZQUNUTCxTQUFTO1FBQ1g7SUFDRixFQUFFLE9BQU9qQixPQUFZO1FBQ25CLE9BQU9KLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBT0EsTUFBTWlCLE9BQU87UUFBQztJQUNyRDtBQUNGO0FBRUEsZUFBZVgscUJBQXFCWCxHQUFtQixFQUFFQyxHQUFvQixFQUFFTSxNQUF5QjtJQUN0RyxJQUFJO1FBQ0YsTUFBTWdCLGNBQWMsSUFBSXpCLGdFQUFjQSxDQUFDUztRQUN2QyxNQUFNaUIsY0FBYyxNQUFNRCxZQUFZRSxjQUFjO1FBRXBELE9BQU94QixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCdUIsU0FBU0g7WUFDVEYsU0FBU0UsY0FBYywwQkFBMEI7UUFDbkQ7SUFDRixFQUFFLE9BQU9uQixPQUFZO1FBQ25CLE9BQU9KLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBT0EsTUFBTWlCLE9BQU87UUFBQztJQUNyRDtBQUNGO0FBRUEsZUFBZVYsaUJBQWlCWixHQUFtQixFQUFFQyxHQUFvQixFQUFFTSxNQUF5QjtJQUNsRyxJQUFJO1FBQ0YsTUFBTWdCLGNBQWMsSUFBSXpCLGdFQUFjQSxDQUFDUztRQUN2QyxNQUFNcUIsVUFBVSxNQUFNTCxZQUFZTSxVQUFVO1FBRTVDLE9BQU81QixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCdUIsU0FBUztZQUNURyxNQUFNRjtRQUNSO0lBQ0YsRUFBRSxPQUFPdkIsT0FBWTtRQUNuQixPQUFPSixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU9BLE1BQU1pQixPQUFPO1FBQUM7SUFDckQ7QUFDRjtBQUVBLGVBQWVULGVBQWViLEdBQW1CLEVBQUVDLEdBQW9CLEVBQUVNLE1BQXlCO0lBQ2hHLElBQUk7UUFDRixNQUFNLEVBQUV3QixNQUFNLEVBQUUsR0FBRy9CLElBQUlTLElBQUk7UUFFM0IsSUFBSSxDQUFDc0IsUUFBUTtZQUNYLE9BQU85QixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQXFCO1FBQzVEO1FBRUEsTUFBTWtCLGNBQWMsSUFBSXpCLGdFQUFjQSxDQUFDUztRQUN2QyxNQUFNeUIsUUFBUSxNQUFNVCxZQUFZVSxlQUFlLENBQUNGO1FBRWhELE9BQU85QixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCdUIsU0FBUztZQUNURyxNQUFNO2dCQUFFQztnQkFBUUM7WUFBTTtRQUN4QjtJQUNGLEVBQUUsT0FBTzNCLE9BQVk7UUFDbkIsT0FBT0osSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPQSxNQUFNaUIsT0FBTztRQUFDO0lBQ3JEO0FBQ0Y7QUFFQSxlQUFlUixrQkFBa0JkLEdBQW1CLEVBQUVDLEdBQW9CLEVBQUVNLE1BQXlCLEVBQUVDLEtBQVU7SUFDL0csSUFBSTtRQUNGLE1BQU0sRUFBRXVCLE1BQU0sRUFBRUcsSUFBSSxFQUFFQyxRQUFRLEVBQUVDLFFBQVEsRUFBRUMsVUFBVSxFQUFFLEdBQUc3QjtRQUV6RCxJQUFJLENBQUN1QixVQUFVLENBQUNHLFFBQVEsQ0FBQ0MsVUFBVTtZQUNqQyxPQUFPbEMsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUEwQztRQUNqRjtRQUVBLE1BQU1rQixjQUFjLElBQUl6QixnRUFBY0EsQ0FBQ1M7UUFDdkMsTUFBTStCLFNBQVMsTUFBTWYsWUFBWWdCLGdCQUFnQixDQUFDO1lBQ2hEUjtZQUNBRztZQUNBTSxNQUFNO1lBQ05MLFVBQVVNLFdBQVdOO1lBQ3JCQyxVQUFVQSxXQUFXSyxXQUFXTCxZQUFZTTtZQUM1Q0wsWUFBWUEsYUFBYUksV0FBV0osY0FBY0s7UUFDcEQ7UUFFQSxPQUFPekMsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQnVCLFNBQVM7WUFDVEcsTUFBTVE7UUFDUjtJQUNGLEVBQUUsT0FBT2pDLE9BQVk7UUFDbkIsT0FBT0osSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPQSxNQUFNaUIsT0FBTztRQUFDO0lBQ3JEO0FBQ0Y7QUFFQSxlQUFlUCxpQkFBaUJmLEdBQW1CLEVBQUVDLEdBQW9CLEVBQUVNLE1BQXlCLEVBQUVDLEtBQVU7SUFDOUcsSUFBSTtRQUNGLE1BQU0sRUFBRXVCLE1BQU0sRUFBRUcsSUFBSSxFQUFFQyxRQUFRLEVBQUVILEtBQUssRUFBRUksUUFBUSxFQUFFQyxVQUFVLEVBQUUsR0FBRzdCO1FBRWhFLElBQUksQ0FBQ3VCLFVBQVUsQ0FBQ0csUUFBUSxDQUFDQyxZQUFZLENBQUNILE9BQU87WUFDM0MsT0FBTy9CLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBaUQ7UUFDeEY7UUFFQSxNQUFNa0IsY0FBYyxJQUFJekIsZ0VBQWNBLENBQUNTO1FBQ3ZDLE1BQU0rQixTQUFTLE1BQU1mLFlBQVlvQixlQUFlLENBQUM7WUFDL0NaO1lBQ0FHO1lBQ0FNLE1BQU07WUFDTkwsVUFBVU0sV0FBV047WUFDckJILE9BQU9TLFdBQVdUO1lBQ2xCSSxVQUFVQSxXQUFXSyxXQUFXTCxZQUFZTTtZQUM1Q0wsWUFBWUEsYUFBYUksV0FBV0osY0FBY0s7UUFDcEQ7UUFFQSxPQUFPekMsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQnVCLFNBQVM7WUFDVEcsTUFBTVE7UUFDUjtJQUNGLEVBQUUsT0FBT2pDLE9BQVk7UUFDbkIsT0FBT0osSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPQSxNQUFNaUIsT0FBTztRQUFDO0lBQ3JEO0FBQ0Y7QUFFQSxlQUFlTixtQkFBbUJoQixHQUFtQixFQUFFQyxHQUFvQixFQUFFTSxNQUF5QjtJQUNwRyxJQUFJO1FBQ0YsTUFBTWdCLGNBQWMsSUFBSXpCLGdFQUFjQSxDQUFDUztRQUN2QyxNQUFNcUMsWUFBWSxNQUFNckIsWUFBWXNCLFlBQVk7UUFFaEQsT0FBTzVDLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDMUJ1QixTQUFTO1lBQ1RHLE1BQU1jO1FBQ1I7SUFDRixFQUFFLE9BQU92QyxPQUFZO1FBQ25CLE9BQU9KLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBT0EsTUFBTWlCLE9BQU87UUFBQztJQUNyRDtBQUNGO0FBRUEsZUFBZUwsb0JBQW9CakIsR0FBbUIsRUFBRUMsR0FBb0IsRUFBRU0sTUFBeUIsRUFBRUMsS0FBVTtJQUNqSCxJQUFJO1FBQ0YsTUFBTSxFQUFFdUIsTUFBTSxFQUFFSSxRQUFRLEVBQUUsR0FBRzNCO1FBRTdCLElBQUksQ0FBQ3VCLFFBQVE7WUFDWCxPQUFPOUIsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFxQjtRQUM1RDtRQUVBLE1BQU1rQixjQUFjLElBQUl6QixnRUFBY0EsQ0FBQ1M7UUFDdkMsTUFBTStCLFNBQVMsTUFBTWYsWUFBWXVCLGFBQWEsQ0FBQ2YsUUFBUUksV0FBV00sV0FBV04sWUFBWU87UUFFekYsT0FBT3pDLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDMUJ1QixTQUFTO1lBQ1RHLE1BQU1RO1FBQ1I7SUFDRixFQUFFLE9BQU9qQyxPQUFZO1FBQ25CLE9BQU9KLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBT0EsTUFBTWlCLE9BQU87UUFBQztJQUNyRDtBQUNGO0FBRUEsZUFBZUosc0JBQXNCbEIsR0FBbUIsRUFBRUMsR0FBb0IsRUFBRU0sTUFBeUI7SUFDdkcsSUFBSTtRQUNGLE1BQU0sRUFBRXdCLE1BQU0sRUFBRWdCLEtBQUssRUFBRSxHQUFHL0MsSUFBSVMsSUFBSTtRQUVsQyxNQUFNYyxjQUFjLElBQUl6QixnRUFBY0EsQ0FBQ1M7UUFDdkMsTUFBTXlDLFVBQVUsTUFBTXpCLFlBQVkwQixlQUFlLENBQUNsQixRQUFRZ0IsU0FBUztRQUVuRSxPQUFPOUMsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQnVCLFNBQVM7WUFDVEcsTUFBTWtCO1FBQ1I7SUFDRixFQUFFLE9BQU8zQyxPQUFZO1FBQ25CLE9BQU9KLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBT0EsTUFBTWlCLE9BQU87UUFBQztJQUNyRDtBQUNGO0FBRUEsZUFBZUgsa0JBQWtCbkIsR0FBbUIsRUFBRUMsR0FBb0IsRUFBRU0sTUFBeUIsRUFBRUMsS0FBVTtJQUMvRyxJQUFJO1FBQ0YsTUFBTSxFQUFFMEMsT0FBTyxFQUFFLEdBQUcxQztRQUVwQixJQUFJLENBQUMwQyxTQUFTO1lBQ1osT0FBT2pELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBdUI7UUFDOUQ7UUFFQSxNQUFNa0IsY0FBYyxJQUFJekIsZ0VBQWNBLENBQUNTO1FBQ3ZDLE1BQU0rQixTQUFTLE1BQU1mLFlBQVk0QixXQUFXLENBQUNEO1FBRTdDLE9BQU9qRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCdUIsU0FBUztZQUNURyxNQUFNUTtRQUNSO0lBQ0YsRUFBRSxPQUFPakMsT0FBWTtRQUNuQixPQUFPSixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU9BLE1BQU1pQixPQUFPO1FBQUM7SUFDckQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3ZvaWQtdHJhZGluZy1wbGF0Zm9ybS8uL3BhZ2VzL2FwaS9icm9rZXIvdHJhZGVsb2NrZXIudHM/YTczNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCB7IFRyYWRlTG9ja2VyQVBJLCBUcmFkZUxvY2tlckNvbmZpZyB9IGZyb20gJy4uLy4uLy4uL2xpYi90cmFkZWxvY2tlci1hcGknO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGFjdGlvbiwgY29uZmlnLCBvcmRlciB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgc3dpdGNoIChhY3Rpb24pIHtcclxuICAgICAgY2FzZSAnY29ubmVjdCc6XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZUNvbm5lY3QocmVxLCByZXMsIGNvbmZpZyk7XHJcbiAgICAgIGNhc2UgJ3Rlc3QnOlxyXG4gICAgICAgIHJldHVybiBhd2FpdCBoYW5kbGVUZXN0Q29ubmVjdGlvbihyZXEsIHJlcywgY29uZmlnKTtcclxuICAgICAgY2FzZSAnYmFsYW5jZSc6XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZUdldEJhbGFuY2UocmVxLCByZXMsIGNvbmZpZyk7XHJcbiAgICAgIGNhc2UgJ3ByaWNlJzpcclxuICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlR2V0UHJpY2UocmVxLCByZXMsIGNvbmZpZyk7XHJcbiAgICAgIGNhc2UgJ21hcmtldF9vcmRlcic6XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZU1hcmtldE9yZGVyKHJlcSwgcmVzLCBjb25maWcsIG9yZGVyKTtcclxuICAgICAgY2FzZSAnbGltaXRfb3JkZXInOlxyXG4gICAgICAgIHJldHVybiBhd2FpdCBoYW5kbGVMaW1pdE9yZGVyKHJlcSwgcmVzLCBjb25maWcsIG9yZGVyKTtcclxuICAgICAgY2FzZSAncG9zaXRpb25zJzpcclxuICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlR2V0UG9zaXRpb25zKHJlcSwgcmVzLCBjb25maWcpO1xyXG4gICAgICBjYXNlICdjbG9zZV9wb3NpdGlvbic6XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZUNsb3NlUG9zaXRpb24ocmVxLCByZXMsIGNvbmZpZywgb3JkZXIpO1xyXG4gICAgICBjYXNlICdvcmRlcl9oaXN0b3J5JzpcclxuICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlR2V0T3JkZXJIaXN0b3J5KHJlcSwgcmVzLCBjb25maWcpO1xyXG4gICAgICBjYXNlICdjYW5jZWxfb3JkZXInOlxyXG4gICAgICAgIHJldHVybiBhd2FpdCBoYW5kbGVDYW5jZWxPcmRlcihyZXEsIHJlcywgY29uZmlnLCBvcmRlcik7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdJbnZhbGlkIGFjdGlvbicgfSk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcignVHJhZGVMb2NrZXIgQVBJIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxyXG4gICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsIFxyXG4gICAgICBkZXRhaWxzOiBlcnJvci5tZXNzYWdlIFxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVDb25uZWN0KHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlLCBjb25maWc6IFRyYWRlTG9ja2VyQ29uZmlnKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHRyYWRlbG9ja2VyID0gbmV3IFRyYWRlTG9ja2VyQVBJKGNvbmZpZyk7XHJcbiAgICBcclxuICAgIC8vIFRlc3QgdGhlIGNvbm5lY3Rpb25cclxuICAgIGNvbnN0IGlzQ29ubmVjdGVkID0gYXdhaXQgdHJhZGVsb2NrZXIudGVzdENvbm5lY3Rpb24oKTtcclxuICAgIFxyXG4gICAgaWYgKCFpc0Nvbm5lY3RlZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byBjb25uZWN0IHRvIFRyYWRlTG9ja2VyJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTYXZlIHRoZSBjb25maWd1cmF0aW9uXHJcbiAgICBhd2FpdCB0cmFkZWxvY2tlci5zYXZlQ29uZmlnKCk7XHJcblxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgXHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsIFxyXG4gICAgICBtZXNzYWdlOiAnU3VjY2Vzc2Z1bGx5IGNvbm5lY3RlZCB0byBUcmFkZUxvY2tlcicgXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVRlc3RDb25uZWN0aW9uKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlLCBjb25maWc6IFRyYWRlTG9ja2VyQ29uZmlnKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHRyYWRlbG9ja2VyID0gbmV3IFRyYWRlTG9ja2VyQVBJKGNvbmZpZyk7XHJcbiAgICBjb25zdCBpc0Nvbm5lY3RlZCA9IGF3YWl0IHRyYWRlbG9ja2VyLnRlc3RDb25uZWN0aW9uKCk7XHJcbiAgICBcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFxyXG4gICAgICBzdWNjZXNzOiBpc0Nvbm5lY3RlZCxcclxuICAgICAgbWVzc2FnZTogaXNDb25uZWN0ZWQgPyAnQ29ubmVjdGlvbiBzdWNjZXNzZnVsJyA6ICdDb25uZWN0aW9uIGZhaWxlZCdcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2V0QmFsYW5jZShyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSwgY29uZmlnOiBUcmFkZUxvY2tlckNvbmZpZykge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB0cmFkZWxvY2tlciA9IG5ldyBUcmFkZUxvY2tlckFQSShjb25maWcpO1xyXG4gICAgY29uc3QgYmFsYW5jZSA9IGF3YWl0IHRyYWRlbG9ja2VyLmdldEJhbGFuY2UoKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgXHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsIFxyXG4gICAgICBkYXRhOiBiYWxhbmNlIFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVHZXRQcmljZShyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSwgY29uZmlnOiBUcmFkZUxvY2tlckNvbmZpZykge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHN5bWJvbCB9ID0gcmVxLmJvZHk7XHJcbiAgICBcclxuICAgIGlmICghc3ltYm9sKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnU3ltYm9sIGlzIHJlcXVpcmVkJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0cmFkZWxvY2tlciA9IG5ldyBUcmFkZUxvY2tlckFQSShjb25maWcpO1xyXG4gICAgY29uc3QgcHJpY2UgPSBhd2FpdCB0cmFkZWxvY2tlci5nZXRDdXJyZW50UHJpY2Uoc3ltYm9sKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgXHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsIFxyXG4gICAgICBkYXRhOiB7IHN5bWJvbCwgcHJpY2UgfSBcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlTWFya2V0T3JkZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UsIGNvbmZpZzogVHJhZGVMb2NrZXJDb25maWcsIG9yZGVyOiBhbnkpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBzeW1ib2wsIHNpZGUsIHF1YW50aXR5LCBzdG9wTG9zcywgdGFrZVByb2ZpdCB9ID0gb3JkZXI7XHJcbiAgICBcclxuICAgIGlmICghc3ltYm9sIHx8ICFzaWRlIHx8ICFxdWFudGl0eSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ1N5bWJvbCwgc2lkZSwgYW5kIHF1YW50aXR5IGFyZSByZXF1aXJlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdHJhZGVsb2NrZXIgPSBuZXcgVHJhZGVMb2NrZXJBUEkoY29uZmlnKTtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRyYWRlbG9ja2VyLnBsYWNlTWFya2V0T3JkZXIoe1xyXG4gICAgICBzeW1ib2wsXHJcbiAgICAgIHNpZGUsXHJcbiAgICAgIHR5cGU6ICdtYXJrZXQnLFxyXG4gICAgICBxdWFudGl0eTogcGFyc2VGbG9hdChxdWFudGl0eSksXHJcbiAgICAgIHN0b3BMb3NzOiBzdG9wTG9zcyA/IHBhcnNlRmxvYXQoc3RvcExvc3MpIDogdW5kZWZpbmVkLFxyXG4gICAgICB0YWtlUHJvZml0OiB0YWtlUHJvZml0ID8gcGFyc2VGbG9hdCh0YWtlUHJvZml0KSA6IHVuZGVmaW5lZFxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFxyXG4gICAgICBzdWNjZXNzOiB0cnVlLCBcclxuICAgICAgZGF0YTogcmVzdWx0IFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVMaW1pdE9yZGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlLCBjb25maWc6IFRyYWRlTG9ja2VyQ29uZmlnLCBvcmRlcjogYW55KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgc3ltYm9sLCBzaWRlLCBxdWFudGl0eSwgcHJpY2UsIHN0b3BMb3NzLCB0YWtlUHJvZml0IH0gPSBvcmRlcjtcclxuICAgIFxyXG4gICAgaWYgKCFzeW1ib2wgfHwgIXNpZGUgfHwgIXF1YW50aXR5IHx8ICFwcmljZSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ1N5bWJvbCwgc2lkZSwgcXVhbnRpdHksIGFuZCBwcmljZSBhcmUgcmVxdWlyZWQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRyYWRlbG9ja2VyID0gbmV3IFRyYWRlTG9ja2VyQVBJKGNvbmZpZyk7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0cmFkZWxvY2tlci5wbGFjZUxpbWl0T3JkZXIoe1xyXG4gICAgICBzeW1ib2wsXHJcbiAgICAgIHNpZGUsXHJcbiAgICAgIHR5cGU6ICdsaW1pdCcsXHJcbiAgICAgIHF1YW50aXR5OiBwYXJzZUZsb2F0KHF1YW50aXR5KSxcclxuICAgICAgcHJpY2U6IHBhcnNlRmxvYXQocHJpY2UpLFxyXG4gICAgICBzdG9wTG9zczogc3RvcExvc3MgPyBwYXJzZUZsb2F0KHN0b3BMb3NzKSA6IHVuZGVmaW5lZCxcclxuICAgICAgdGFrZVByb2ZpdDogdGFrZVByb2ZpdCA/IHBhcnNlRmxvYXQodGFrZVByb2ZpdCkgOiB1bmRlZmluZWRcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBcclxuICAgICAgc3VjY2VzczogdHJ1ZSwgXHJcbiAgICAgIGRhdGE6IHJlc3VsdCBcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2V0UG9zaXRpb25zKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlLCBjb25maWc6IFRyYWRlTG9ja2VyQ29uZmlnKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHRyYWRlbG9ja2VyID0gbmV3IFRyYWRlTG9ja2VyQVBJKGNvbmZpZyk7XHJcbiAgICBjb25zdCBwb3NpdGlvbnMgPSBhd2FpdCB0cmFkZWxvY2tlci5nZXRQb3NpdGlvbnMoKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgXHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsIFxyXG4gICAgICBkYXRhOiBwb3NpdGlvbnMgXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUNsb3NlUG9zaXRpb24ocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UsIGNvbmZpZzogVHJhZGVMb2NrZXJDb25maWcsIG9yZGVyOiBhbnkpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBzeW1ib2wsIHF1YW50aXR5IH0gPSBvcmRlcjtcclxuICAgIFxyXG4gICAgaWYgKCFzeW1ib2wpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdTeW1ib2wgaXMgcmVxdWlyZWQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRyYWRlbG9ja2VyID0gbmV3IFRyYWRlTG9ja2VyQVBJKGNvbmZpZyk7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0cmFkZWxvY2tlci5jbG9zZVBvc2l0aW9uKHN5bWJvbCwgcXVhbnRpdHkgPyBwYXJzZUZsb2F0KHF1YW50aXR5KSA6IHVuZGVmaW5lZCk7XHJcbiAgICBcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFxyXG4gICAgICBzdWNjZXNzOiB0cnVlLCBcclxuICAgICAgZGF0YTogcmVzdWx0IFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVHZXRPcmRlckhpc3RvcnkocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UsIGNvbmZpZzogVHJhZGVMb2NrZXJDb25maWcpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBzeW1ib2wsIGxpbWl0IH0gPSByZXEuYm9keTtcclxuICAgIFxyXG4gICAgY29uc3QgdHJhZGVsb2NrZXIgPSBuZXcgVHJhZGVMb2NrZXJBUEkoY29uZmlnKTtcclxuICAgIGNvbnN0IGhpc3RvcnkgPSBhd2FpdCB0cmFkZWxvY2tlci5nZXRPcmRlckhpc3Rvcnkoc3ltYm9sLCBsaW1pdCB8fCAxMDApO1xyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBcclxuICAgICAgc3VjY2VzczogdHJ1ZSwgXHJcbiAgICAgIGRhdGE6IGhpc3RvcnkgXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUNhbmNlbE9yZGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlLCBjb25maWc6IFRyYWRlTG9ja2VyQ29uZmlnLCBvcmRlcjogYW55KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgb3JkZXJJZCB9ID0gb3JkZXI7XHJcbiAgICBcclxuICAgIGlmICghb3JkZXJJZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ09yZGVyIElEIGlzIHJlcXVpcmVkJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0cmFkZWxvY2tlciA9IG5ldyBUcmFkZUxvY2tlckFQSShjb25maWcpO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdHJhZGVsb2NrZXIuY2FuY2VsT3JkZXIob3JkZXJJZCk7XHJcbiAgICBcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFxyXG4gICAgICBzdWNjZXNzOiB0cnVlLCBcclxuICAgICAgZGF0YTogcmVzdWx0IFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgfVxyXG59ICJdLCJuYW1lcyI6WyJUcmFkZUxvY2tlckFQSSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJhY3Rpb24iLCJjb25maWciLCJvcmRlciIsImJvZHkiLCJoYW5kbGVDb25uZWN0IiwiaGFuZGxlVGVzdENvbm5lY3Rpb24iLCJoYW5kbGVHZXRCYWxhbmNlIiwiaGFuZGxlR2V0UHJpY2UiLCJoYW5kbGVNYXJrZXRPcmRlciIsImhhbmRsZUxpbWl0T3JkZXIiLCJoYW5kbGVHZXRQb3NpdGlvbnMiLCJoYW5kbGVDbG9zZVBvc2l0aW9uIiwiaGFuZGxlR2V0T3JkZXJIaXN0b3J5IiwiaGFuZGxlQ2FuY2VsT3JkZXIiLCJjb25zb2xlIiwiZGV0YWlscyIsIm1lc3NhZ2UiLCJ0cmFkZWxvY2tlciIsImlzQ29ubmVjdGVkIiwidGVzdENvbm5lY3Rpb24iLCJzYXZlQ29uZmlnIiwic3VjY2VzcyIsImJhbGFuY2UiLCJnZXRCYWxhbmNlIiwiZGF0YSIsInN5bWJvbCIsInByaWNlIiwiZ2V0Q3VycmVudFByaWNlIiwic2lkZSIsInF1YW50aXR5Iiwic3RvcExvc3MiLCJ0YWtlUHJvZml0IiwicmVzdWx0IiwicGxhY2VNYXJrZXRPcmRlciIsInR5cGUiLCJwYXJzZUZsb2F0IiwidW5kZWZpbmVkIiwicGxhY2VMaW1pdE9yZGVyIiwicG9zaXRpb25zIiwiZ2V0UG9zaXRpb25zIiwiY2xvc2VQb3NpdGlvbiIsImxpbWl0IiwiaGlzdG9yeSIsImdldE9yZGVySGlzdG9yeSIsIm9yZGVySWQiLCJjYW5jZWxPcmRlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/broker/tradelocker.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbroker%2Ftradelocker&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbroker%5Ctradelocker.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();